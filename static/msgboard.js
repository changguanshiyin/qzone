var MSG={global:{total:0,isBatchMode:!1,allowComment:!0,auditOn:!1,auditNum:0},CONST:{IMGCACHE_DOMAIN:parent.imgcacheDomain,CGI_MSGBOARD_DOMAIN:parent.g_MsgBoard_Domain,MSG_TYPE_HINT:0,MSG_TYPE_SUCC:4,MSG_TYPE_ERROR:5,MSG_TYPE_LOADING:6,MAX_COMMENT_LENGTH:4e3,MAX_AUTHORMSG_LENGTH:1536},updatePageView:function(){if(IS_OWNER&&($("popupGiftBtn").style.display="none"),(IS_STAR||IS_BIZ||IS_CERTIFIED)&&QZFL.css.addClassName($("ulCommentList"),"list_without_avatar"),IS_CERTIFIED&&($("btnAddEssenceBatch")&&($("btnAddEssenceBatch").style.display=""),$("btnAddEssenceBatchBottom")&&($("btnAddEssenceBatchBottom").style.display="")),IS_OWNER){var t=$("btnToSet"),e=$e("ul.sub_list",t.parentNode).elements[0];QZFL.css.removeClassName(t,"none"),QZFL.event.addEvent(e,"mouseout",function(){e.style.display="none"}),QZFL.event.addEvent(t,"mouseover",function(){e.style.display=""}),QZFL.event.addEvent(e,"mouseover",function(){e.style.display=""}),$e(".comments_set .sub_list li>a").each(function(t){QZFL.event.addEvent(t,"mouseover",function(){QZFL.css.addClassName(this.parentNode,"bg2")}),QZFL.event.addEvent(t,"mouseout",function(){QZFL.css.removeClassName(this.parentNode,"bg2")})}),MSG.global.auditOn&&QZFL.css.removeClassName($("btnGotoAudit"),"none"),$("signCheckLabel").title="勾选后显示用户签名档";var n=$("signCheck").checked=!1;try{n=-1<top.location.href.indexOf("debug=1")}catch(t){}t=n?new Date:QZONE.FP.getSvrTime();t.getTime()<new Date(13964706e5).getTime()&&t.getTime()>new Date(1396467e6).getTime()?($("cheatHintArea").innerHTML='<strong class="icon_hint"><span>提示</span></strong><span>尊敬的QQ空间用户：为提升服务器的稳定运行，提高产品质量，我司将于2014年4月3日(周四) 3:30~4:30对服务器进行更新维护，期间留言板操作将受到影响。为此给您带来的不便，我们深表歉意。<a href="http://kf.qq.com/faq/130926meqeyA14040226v6Bj.html" target="_blank">点此了解详情</a></span><a href="javascript:;" onclick="$(\'cheatHintArea\').style.display=\'none\';return false;" title="关闭提示" class="hint_close">关闭</a>',$e("#cheatHintArea").show()):IS_CERTIFIED?($("cheatHintArea").innerHTML='<strong class="icon_hint"><span>提示</span></strong><span>温馨提示，您是尊贵的认证空间用户，您可以选择置顶留言显示在最前面和用户分享。</span><a href="javascript:;" onclick="$(\'cheatHintArea\').style.display=\'none\';return false;" title="关闭提示" class="hint_close">关闭</a>',$e("#cheatHintArea").show()):IS_STAR||IS_BIZ||($("cheatHintArea").innerHTML='<strong class="icon_hint"><span>提示</span></strong><span>留言板已默认为大家开启了非好友留言的主人审核功能，查看、保护隐私都由自己来决定！</span><a href="javascript:;" onclick="$(\'cheatHintArea\').style.display=\'none\';return false;" title="关闭提示" class="hint_close">关闭</a>',$e("#cheatHintArea").show())}(IS_STAR||IS_BIZ||IS_CERTIFIED)&&($("useSign").style.display="none")},sendGift:function(t,e){QZONE.FP.sendGift(t);var n=QZONE.FP.getStatPackage();switch(e){case 0:n.hotClick("isd.qzonegift.pay.pay-wall1","mall.qzone.qq.com",location.pathname);break;case 1:n.hotClick("isd.qzonegift.pay.pay-wall2","mall.qzone.qq.com",location.pathname)}},bindPageEvent:function(){var t=this;QZFL.event.addEvent($("sendGift"),"click",function(){t.sendGift(SPACE_UIN,0)}),QZFL.event.addEvent($("privCheckLbl"),"mousedown",function(t){if(!QZONE.FP.isVipUser(!0))return QZFL.event.preventDefault(t),!1})},pageStart:function(t){LOGIN_UIN&&QZONE.FP.getRemarkList&&QZONE.FP.getRemarkList(function(t){MSG.util.setRemark(t)}),MSG.global.auditOn=t.auditON,MSG.global.auditNum=t.auditNum,this.updatePageView(),this.bindPageEvent(),QZBlog.Util.Statistic.sendPV("msgboard","msg.qzone.qq.com"),MSG.util.nameCard.loadScript()}};!function(){var e={main:"get_msgb",page:"get_msgb",modifyinfo:"mod_hostword",modifymsg:"mod_msgb",delcomment:"del_reply",delanswer:"del_msgb",commentanswer:"add_reply",addanswer:"add_msgb",setAudit:"msgb_verify_switch.cgi",addessence:"add_essence",delessence:"del_msgb"},n={};MSG.util=QZFL.object.extend(MSG.util,{getUrl:function(t){return"http://m.qzone.qq.com/cgi-bin/new/"+e[t]},getRemark:function(t,e){return n[t]&&escHTML(n[t])||e||t},setRemark:function(t){(n=t)[LOGIN_UIN]="我"},speedReport:function(t){var e,n="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1=175&flag2=113&flag3=1&flag4=0&flag5=0&uin="+SPACE_UIN+"&hh="+Math.random();for(e in t)n+="&"+e+"="+(t[e]-parent.mgbBasePoint);var o=new Image;setTimeout(function(){o.src=n},1e3)},nameCard:{loaded:!1,loadScript:function(){var t=new QZONE.jsLoader;t.onload=QZONE.event.bind(this,function(){MSG.util.nameCard.loaded=!0}),t.load("http://"+MSG.CONST.IMGCACHE_DOMAIN+"/qzone/v5/namecardv2.js",document,"utf-8")},init:function(t){this._checkReady(QZFL.event.bind(this,"init",t))&&setTimeout(function(){QZONE.namecard.init(t)},2e3)},_checkReady:function(t){return!!MSG.util.nameCard.loaded||(setTimeout(QZONE.event.bind(null,t),500),!1)}},scrollTo:function(t,e){var n=QZONE.FP.getQzoneConfig().full?QZFL.dom.getPosition(t).top+QZFL.dom.getPosition(QZONE.FP.getCurrentAppWindow().frameElement).top-30:QZFL.dom.getPosition(t).top,t=QZONE.FP.getQzoneConfig().full?parent.document:document,o=t["CSS1Compat"!=t.compatMode||QZFL.userAgent.webkit?"body":"documentElement"],i=setInterval(function(){o.scrollTop>n?o.scrollTop-=100:(clearInterval(i),i=null,e&&e())},10)},ContentProperty:function(t){var e={image:/\[img\]http(.[^\]]*)\[\/img\]/gi,imagesize:/\[img,(\d{1,4}),(\d{1,4})\]http(.[^\]]*)\[\/img\]/gi,music:/\[music\]http(.[^\]]*)\[\/music\]/gi,qqshow:/\[qqshow,(\d{1,3}),(\d{1,3}),(\d{1,3}),(\d{1,3})(,.*?|)\]http(.[^\]]*)\[\/qqshow\]/gi};this._strContent=t,this._parseContent=function(){for(var t in e)this[t]=this._checkUbbTagsCnt(e[t])},this._checkUbbTagsCnt=function(t){for(var e=0;null!=t.exec(this._strContent);)++e;return e},this._parseContent()},getPortraitInfo:function(t,e){var n=!1,o=QZONE.FP.getPortraitList(t,function(t){n||e(t)},{needScore:1,needVIP:1});o&&(setTimeout(function(){e(o)},0),n=!0)}})}();try{parent.mgbSpeedPoint[5]=(new Date).getTime()}catch(e){}try{parent.mgbSpeedPoint&&!window.isAjaxMode&&(setTimeout(function(){MSG.util.speedReport(parent.mgbSpeedPoint),parent.mgbSpeedPoint=null,parent.mgbBasePoint=null},1e3),window._o_t?3e3<=window._o_t&&window._o_t<=5e3?QZBlog.Util.Statistic.sendPV("/static_msgb/getmsg_gt_3s","taotaoact.qzone.qq.com"):5e3<window._o_t&&QZBlog.Util.Statistic.sendPV("/static_msgb/getmsg_gt_5s","taotaoact.qzone.qq.com"):QZBlog.Util.Statistic.sendPV("/static_msgb/getmsg_timeout","taotaoact.qzone.qq.com"))}catch(err){}!function(MSG){var _PAGE_DATA={},_CUR_EDIT_COMMENT_IDX,_BATCH_MODE=!1,PAGE_SIZE=PAGE_SIZE||10,COMMENT_MODULE_COLL={};window._originalConfirm=window.confirm,window.confirm=function(t){return"确定要删除该评论么？"==t?window._originalConfirm("确定要删除该回复么？"):"您确认要放弃正在编辑的评论吗？"==t||window._originalConfirm(t)};var _initReplyComponent=function(callback){QZFL.imports("/qzone/app/snslib/widget/commentModule/commentModule_1.1.js",function(){SNSLib.jsMVC=new function(){var $u=new function(){this.capitalize=function(t){return[t.charAt(0).toUpperCase(),t.substring(1,t.length)].join("")}};this.Model=function(){},this.Model.prototype=new function(){this.genProperties=function(){for(var o=this,t=arguments.length-1;0<=t;t--){var i=arguments[t],s=$u.capitalize(i);!function(){var e=["_",i].join(""),t=["get",s].join(""),n=["set",s].join("");o[t]=function(){return this[e]},o[n]=function(t){this[e]=t}}()}},this.setProperties=function(values){if(values)for(var i in values){var setMethod=this["set"+$u.capitalize(i)],value;setMethod&&(value=values[i],value&&value.modelName&&(value=new(eval(value.modelName))(value)),setMethod.call(this,value))}}}},SNSLib.Reply=function(t){this.setProperties(t)},SNSLib.Reply.prototype=new SNSLib.jsMVC.Model,SNSLib.Reply.prototype.genProperties("id","content","poster","postTime","orginalTime"),SNSLib.User=function(t){this.setProperties(t)},SNSLib.User.prototype=new SNSLib.jsMVC.Model,SNSLib.User.prototype.genProperties("uin","nickname","avatarUrl"),SNSLib.selfConfig={showRepliesByDefault:!1,showPaginationForm:!1,emoticonSupported:!0,maxCommentLength:2e3,avatarTemplate:'<a href="http://user.qzone.qq.com/${uin}" target="_blank" link="nameCard_${uin}" class="q_namecard"><img src="${avatarUrl}" style="width:35px; height:35px;" name="portraitImg_${uin}" alt="${nickname}" /></a>',commentTemplate:'<div id="${id}_comment_${comment.id}_contentBlock" class="mod_comment_cont"><p class="mod_comment_avatar">${avatarImage}</p><div class="comment_cont"><p><span class="mod_comment_authorname"><a id="${id}_comment_${comment.id}_poster_nickname" link="nameCard_${comment.poster.uin}" name="msg_link_${comment.poster.uin}" href="${userLinkUrl}" target="${userLinkTarget}" class="c_tx q_namecard">${comment.poster.nickname}</a></span> ${comment.content}</p><p class="mod_comment_last"><span class="c_tx3 mod_comment_time">${comment.postTime}</span> <a id="${id}_comment_${comment.id}_replyBoxToggle" href="javascript:;" class="c_tx" style="display:none;">回复</a> <a id="${id}_comment_${comment.id}_removeButton" href="javascript:;" class="c_tx mod_comment_del" style="display:none;">删除</a></p></div></div><div id="${id}_comment_${comment.id}_replyListContainer" class="mod_comment_reply" style="display:none;"><div id="${id}_comment_${comment.id}_replyListWrapper"><ol id="${id}_comment_${comment.id}_replyList"></ol><div id="${id}_comment_${comment.id}_replyBox" class="mod_comment_post" style="display:none;"><p id="${id}_comment_${comment.id}_emoticonButtonWrapper"><a id="${id}_comment_${comment.id}_emoticonButton" title="表情" class="bg_img mod_comment_emoticons">表情</a></p><p class="mod_comment_textarea"><span><textarea id="${id}_comment_${comment.id}_content" cols="60" rows="5" class="textarea"></textarea></span></p><p id="${id}_comment_${comment.id}_hintBox" class="hint" style="display:none;"><span class="icon_hint">提示：</span><span id="${id}_comment_${comment.id}_hint"></span></p><p class="mod_comment_option"><span class="mod_comment_sub"><button type="button" id="${id}_comment_${comment.id}_postButton" class="bt_tx2">确定</button><a id="${id}_comment_${comment.id}_cancelButton" href="javascript:;" title="取消" class="c_tx3">取消</a></span><span class="c_tx3 mod_comment_other"><span id="${id}_comment_${comment.id}_currentLength"></span>/<span id="${id}_comment_${comment.id}_maxLength"></span></span></p></div></div></div>'},callback()})},_showCommentItemReply=function(a){var r,t;a.replyList&&!a.isEsscence&&(window.SNSLib?(window.SNSLib.selfConfig.id="commentModule"+a.id,t=COMMENT_MODULE_COLL[a.id]=new SNSLib.widget.CommentModule(window.SNSLib.selfConfig),r=a.replyList,t.loadComments=function(t,e){var n,o;this.answerid=a.id,r.length?(o=[],QZFL.each(r,function(t){o.push(t.uin)}),n=o,MSG.util.getPortraitInfo(n,function(i){var s=[];QZFL.each(r,function(t,e){var n=i[t.uin]?i[t.uin][6]:t.uin,o=new SNSLib.User({uin:t.uin,nickname:QZFL.string.restHTML(MSG.util.getRemark(t.uin,n)),avatarUrl:QZONE.FP.getPURL(t.uin,30)}),n=parseMentionFormat(t.content,!0),t=new SNSLib.Reply({uin:t.uin,id:a.id+"_"+e,content:n,poster:o,orginalTime:t.time,postTime:t.time?QZFL.string.timeFormatString(1e3*t.time,"{Y}-{M}-{d} {h}:{m}"):""});s.push(t)}),t.onSuccess(s)})):t.onSuccess([])},t.isAbleToReply=function(t){return!1},t.isAbleToRemove=function(t){t=t.getPoster().getUin();return!(!IS_OWNER&&t!=LOGIN_UIN)},t.onError=function(t,e){switch(t){case"comment-too-long":case"reply-too-long":alert("回复内容过长");break;case"comment-no-content":case"reply-no-content":alert("请输入回复内容")}},t.postComment=QZONE.event.bind(this,function(module){return QZONE.event.bind(this,function(t,e){_doReply(module,t,e)})})(t),t.removeComment=function(t,e){MSG.list.removeCommentReply(this.answerid,t.getPoster().getUin(),t.getOrginalTime(),e)},t.init($("divComment_"+a.id)),$("divComment_"+a.id).style.display=0<r.length?"":"none",QZFL.css[r.length?"removeClassName":"addClassName"]($("divComment_"+a.id+"_line"),"none"),t=!1,(IS_OWNER||r.length&&a.uin==LOGIN_UIN)&&MSG.global.allowComment&&(!IS_STAR||a.uin!=LOGIN_UIN||IS_OWNER)&&(t=!0),t||QZFL.css.addClassName($("pLi_"+a.id),"hide_comment_tip")):_initReplyComponent(function(){_showCommentItemReply(a)}))},_doReply=function(n,o){var t={hostUin:SPACE_UIN,msgId:n.answerid,format:"jsonp",content:o,uin:LOGIN_UIN},e=MSG.util.getUrl("commentanswer"),t=new QZBlog.Util.NetRequest({url:e,data:t,method:"post",charset:"utf-8",uniqueCGI:!0});t.onSuccess=function(t){QZONE.FP.showMsgbox("操作成功!",MSG.CONST.MSG_TYPE_SUCC,2e3);var e={uin:LOGIN_UIN,content:o,time:t.data.replytime},t=MSG.list.getItemDataByCommentId(n.answerid);t.replyList.push(e),_showCommentItemReply(t)},t.send()},MSG_LIST={showPage:function(n){void 0===n&&(n=CUR_PAGE_INDEX);var o="";n&&(o=n>CUR_PAGE_INDEX?"next_page":"prev_page"),CUR_PAGE_INDEX=n;var i=this;this.getPageData(n,function(t){if(!t.total&&1<n)i.showPage(n-1);else{$("ulCommentList").innerHTML=tmpl(MSG_LIST_TPL,t),i.bindMenuEvent(),procCommentArea(),i.showUserExtractInfo(t.items);for(var e=0;e<t.items.length;e++)_showCommentItemReply(t.items[e]);i.showPagination(n,t.total),i.updatePageView(),MSG.util.scrollTo($("pager_top")),EditCommentEditor.resetInstanceCollection(),MSG.Signature.toggleSignature(),o&&QZBlog.Util.Statistic.sendPV(o,"msg.qzone.qq.com")}})},getPageData:function(t,e){var n={uin:LOGIN_UIN,hostUin:SPACE_UIN,num:PAGE_SIZE,start:PAGE_SIZE*(t-1),hostword:0,essence:1,r:Math.random()},t=MSG.util.getUrl("page"),n=new QZBlog.Util.NetRequest({url:t,data:n,method:"get",charset:"utf-8",uniqueCGI:!0});n.onSuccess=function(t){_PAGE_DATA=t.data,e(_fixPageData(t.data))},n.send()},getItemDataByCommentId:function(t){for(var e=_PAGE_DATA.items.length-1;0<=e;e--)if(_PAGE_DATA.items[e].id==t)return _PAGE_DATA.items[e];return null},showPagination:function(t,e){var n=this,e=e?Math.ceil(e/PAGE_SIZE):1;location.hash="#page="+t,QZBlog.Util.PageIndexManager.init([$("pager_top"),$("pager_bottom")],e,t,function(t){n.showPage(t)})},showUserExtractInfo:function(t){var e=[],n={};QZFL.each(t,function(t){t.uin&&(n[t.uin]||(t.bmp=QZFL.string.trim(t.bmp),t.bmp=QZFL.string.fillLength(t.bmp,16,"0",!1),n[t.uin]=QZFL.string.trim(t.bmp),e.push(t.uin)))}),QZFL.each(n,function(t,e){var n=QZONE.FP.getVipHTML({lv:getUserVIPLevel(t),isVip:isVipUser(t),isYearVip:isUserVIPExpress(t),isYearExpire:isYearVipExpire(t)},"l",{withYear:1,className:isUserVIPExpress(t)?"year_vip":"normal_vip"});$e("span[rel=user_vip_info_"+e+"]").each(function(t){QZFL.css.removeClassName(t,"none"),t.innerHTML=n})}),MSG.util.getPortraitInfo(e,function(t){QZFL.each(t,function(t,e){var n=QZONE.FP.getQZLevelIconHTML(t[1],!0,0,{clickable:IS_OWNER}),o="等级:"+getUserGrade(t[1])+"  积分:"+t[1];$e("span[rel=user_grade_"+e+"]").each(function(t){QZFL.css.removeClassName(t,"none"),t.title=o,t.innerHTML=n})})})},bindMenuEvent:function(){function e(t,e){var n,o=t.getElementsByTagName("A")[0],i=t.getElementsByTagName("UL")[0];o&&i&&i.getElementsByTagName("LI").length&&(n=QZFL.dom.searchChain(t.parentNode,"parentNode",function(t){return"LI"==t.tagName}),i.style.display=e?"block":"none",QZFL.css[e?"addClassName":"removeClassName"](i,"list_drop_dump"),QZFL.css[e?"addClassName":"removeClassName"](o,"bg bor"),QZFL.css[e?"addClassName":"removeClassName"](t,"drop_list_current"),QZFL.css[e?"addClassName":"removeClassName"](n,"list_drop_now"))}$e("a.drop_list_link").onMouseOver(function(t){this.parentNode.getAttribute("data-disabled")||e(this.parentNode,!0)}),$e("a.drop_list_link").onClick(function(t){this.parentNode.getAttribute("data-disabled")||($e("li",this.parentNode).each(function(t){if(!QZFL.css.hasClassName(t,"none")){t=$e("a",t).elements[0];return t&&t.focus(),!1}}),e(this.parentNode,!0))}),$e("li.drop_list").onMouseLeave(function(t){e(this,!1)}),$e("li.drop_list ul").onClick(function(t){e(this.parentNode,!1)}),$e(".drop_list li a").onHover(function(){$e(this).addClass("bg2")},function(){$e(this).removeClass("bg2")})},bindFuncLinkEvent:function(){var n=this,s={quote:function(t,e){n.quoteComment(t)},addEssence:function(t,e){n.addEssenceSingle(t)},reply:function(t,e){n.showReplyCommentEditor(t)},edit:function(t,e){n.editComment(t)},delete:function(t,e){n.deleteSingle(t)},sendMsg:function(t,e){n.sendMsg(e)},deleteEssence:function(t,e){n.deleteEssenceSingle(t)},report:function(t,e){n.reportComment(t)},moveBlack:function(t,e){n.moveBlack(e)},sendGift:function(t,e){MSG.sendGift(e,1)},editCommentBtn:function(t,e){n._doModifyComment(t)},cancelEditCommentBtn:function(t,e){n.cancelEditComment(t)},toggleBatchMode:function(){n.toggleBathMode()},selectAll:function(){n.selectAll()},batchDelete:function(){n.deleteBatch()}};QZFL.event.addEvent(document.body,"click",function(t){var e=QZFL.event.getTarget(t),n=e.getAttribute("rel"),o=e.getAttribute("uin"),i=e.getAttribute("commentId");n&&s[n]&&("A"==e.tagName&&QZFL.event.preventDefault(t),s[n](i,o))})},sendMsg:function(t){return parent.showMsgSender(t)},showReplyCommentEditor:function(t){t=this.getItemDataByCommentId(t);$("divComment_"+t.id).style.display="",COMMENT_MODULE_COLL[t.id].showCommentBox()},cancelEditComment:function(t,e){_CUR_EDIT_COMMENT_IDX=0,$("commentContentDiv_"+t).style.display="",$("divComment_"+t).parentNode.style.display="",EditCommentEditor.hideEditor(t,e)},editComment:function(t){var e=this.getItemDataByCommentId(t);e&&(_CUR_EDIT_COMMENT_IDX&&t!=_CUR_EDIT_COMMENT_IDX&&!window._originalConfirm("您正在编辑您的留言，点击“确定”将会丢失您的修改。")||_CUR_EDIT_COMMENT_IDX!=t&&(_CUR_EDIT_COMMENT_IDX&&t!=_CUR_EDIT_COMMENT_IDX&&this.cancelEditComment(_CUR_EDIT_COMMENT_IDX),_CUR_EDIT_COMMENT_IDX=t,$("commentContentDiv_"+t).style.display="none",$("divComment_"+t).parentNode.style.display="none",EditCommentEditor.showEditor(t,function(){EditCommentEditor.setContent(t,e.htmlContent)})))},_doModifyComment:function(t){var e,n=this,o=EditCommentEditor.getUbbContent(t);void 0!==o&&(e=MSG.util.getUrl("modifymsg"),t=this.getItemDataByCommentId(t).id,o={hostUin:SPACE_UIN,uin:LOGIN_UIN,msgId:t,content:o,format:"jsonp"},(o=new QZBlog.Util.NetRequest({url:e,data:o,method:"post",charset:"utf-8",uniqueCGI:!0})).onSuccess=function(t){QZONE.FP.showMsgbox(t.message||"修改成功",MSG.CONST.MSG_TYPE_SUCC,1e3),setTimeout(function(){n.showPage()},1e3)},o.send())},removeCommentReply:function(o,t,i,s){var a=this,e=MSG.util.getUrl("delcomment"),t={hostUin:SPACE_UIN,msgId:o,uin:t,replyTime:i,format:"jsonp"},t=new QZBlog.Util.NetRequest({url:e,data:t,method:"post",charset:"utf-8",uniqueCGI:!0});t.onSuccess=function(t){QZONE.FP.showMsgbox(t.message||"删除成功",MSG.CONST.MSG_TYPE_SUCC,2e3),s.onSuccess();for(var e=a.getItemDataByCommentId(o).replyList,n=0;n<e.length;n++)if(e[n].time==i){e=e.splice(n,1);break}},t.send()},deleteItems:function(o,i){var s,a,t;o.length&&(s=this,a=[],(t=new parent.QZFL.widget.Confirm("提示","删除操作不可恢复，您确定要继续么？",{type:5,width:330,height:70,tips:["确定","取消"]})).onConfirm=function(){for(var t=MSG.util.getUrl("delanswer"),e=0;e<o.length;++e)s.getItemDataByCommentId(o[e])&&a.push(s.getItemDataByCommentId(o[e]).uin);var n={hostUin:LOGIN_UIN,idList:o.join(","),uinList:a.join(","),format:"jsonp"},n=new QZBlog.Util.NetRequest({url:t,data:n,method:"post",charset:"utf-8",uniqueCGI:!0});n.onSuccess=function(t){QZONE.FP.showMsgbox(t.message||"删除成功",MSG.CONST.MSG_TYPE_SUCC,1e3),setTimeout(function(){i?i(t):s.showPage()},1e3)},n.send()},t.show())},deleteBatch:function(){var t=[],e=[],n=this;$e(".item_check_box").each(function(){this.checked&&(n.getItemDataByCommentId(this.getAttribute("commentId")).effect&1<<30?e:t).push(this.value)}),t.length||e.length?t.length&&!e.length?this.deleteItems(t):!t.length&&e.length?this.deleteEssenceItems(e):this.deleteItems(t,function(t){setTimeout(function(){n.deleteEssenceItems(e)},100)}):QZONE.FP.showMsgbox("请先选择要删除的留言",MSG.CONST.MSG_TYPE_HINT,2e3),QZONE.event.preventDefault()},deleteSingle:function(t){this.deleteItems([this.getItemDataByCommentId(t).id])},deleteEssenceItems:function(t){var e;t.length&&(e=this,t={hostUin:LOGIN_UIN,idList:t.join(","),format:"jsonp",type:2},(t=new QZBlog.Util.NetRequest({url:MSG.util.getUrl("delessence"),data:t,method:"post",charset:"utf-8",uniqueCGI:!0})).onSuccess=function(t){QZONE.FP.showMsgbox(t.message||"删除成功",MSG.CONST.MSG_TYPE_SUCC,1e3),setTimeout(function(){e.showPage()},1e3)},t.send())},deleteEssenceSingle:function(t){this.deleteEssenceItems([this.getItemDataByCommentId(t).id])},addEssenceBatch:function(){var e=[],n=0,o=this;$e(".item_check_box").each(function(t){t.checked&&(n++,o.getItemDataByCommentId(t.getAttribute("commentId")).effect&1<<30||e.push(t.value))}),e.length?this.addEssenceItems(e.reverse()):QZONE.FP.showMsgbox(n?"已是置顶留言，请勿重复设置！":"请选择想置顶的留言！",MSG.CONST.MSG_TYPE_HINT,2e3),QZONE.event.preventDefault()},addEssenceItems:function(t){var e;t.length&&(e=this,t={hostUin:LOGIN_UIN,idList:t.join(","),start:PAGE_SIZE*(CUR_PAGE_INDEX-1),num:PAGE_SIZE,format:"jsonp"},(t=new QZBlog.Util.NetRequest({url:MSG.util.getUrl("addessence"),data:t,method:"post",charset:"utf-8",uniqueCGI:!0})).onSuccess=function(t){QZONE.FP.showMsgbox(t.message||"置顶成功",MSG.CONST.MSG_TYPE_SUCC,2e3),e.showPage(1)},t.send())},addEssenceSingle:function(t){this.addEssenceItems([this.getItemDataByCommentId(t).id])},moveBlack:function(n){n!=LOGIN_UIN?QZONE.FP.getPortraitList([n],function(t){t=t[n][6],t=new parent.QZFL.widget.Confirm("提示","您准备将"+t+"("+n+")加入您的黑名单，加入后该用户可以访问您的空间，不能在您的空间留言、回复。",{type:5,tips:["确定","取消"],width:345,height:110});t.onConfirm=function(){var t="http://"+parent.g_W_Domain+"/cgi-bin/right/cgi_black_action_new",e={uin:LOGIN_UIN,action:1,act_uin:n},e=new QZFL.FormSender(t,"post",e,"utf-8");e.onSuccess=function(t){msg=t?"succ"==t.ret?"该用户已加入您的黑名单":t.msg:"系统正忙，请稍后操作",QZONE.FP.showMsgbox(msg,MSG.CONST.MSG_TYPE_HINT,2e3)},e.onError=function(t){t=t&&t.msg?t.msg:"系统正忙，请稍后操作";QZONE.FP.showMsgbox(t,MSG.CONST.MSG_TYPE_HINT,2e3)},e.send("_Callback")},t.show()},{needScore:1,needVIP:1}):QZONE.FP.showMsgbox("您不能将自己加入黑名单中",MSG.CONST.MSG_TYPE_HINT,2e3)},reportComment:function(t){t=this.getItemDataByCommentId(t);QZONE.FP.showReportBox({appname:"qzone",subapp:"guestbook",jubaotype:"article",encoding:"utf-8",uin:t.uin,answerid:t.id,replyuin:SPACE_UIN,blogtype:IS_STAR||IS_BIZ||IS_CERTIFIED?1:0})},quoteComment:function(n){var o=this;$e("#divPostPanel").show(),MSG.util.scrollTo($("postCommentAnchor"),function(){var e,t=o.getItemDataByCommentId(n);t&&(e="引自：<cite>"+t.nickname+"</cite>&nbsp;&nbsp;于 <ins>"+t.pubtime+"</ins> 发表的留言<br />引用内容：<br /><br /><q>"+procQuote(t.htmlContent)+"</q>",MSG.comment.getContent(function(t){t=0<=t.toLowerCase().indexOf("<blockquote")?t.replace(/(\<blockquote[^>]+>)(.*?)(<\/blockquote>)/gi,function(){return arguments[1]+e+arguments[3]}):'<br /><blockquote style="overflow-x:hidden;font-size:12px;width:400px;border:dashed 1px gray;margin:10px;padding:10px">'+e+"</blockquote><br />",MSG.comment.setContent(t,{height:150})}))})},selectAll:function(){var t=QZFL.event.getTarget().checked;$e(".item_check_box").each(function(){this.checked=!!t}),$("chkSelectAllBottom").checked=$("chkSelectAll").checked=!!t},toggleBathMode:function(t){null==t&&(t=!_BATCH_MODE),$("btnBatch").title=$("btnBatch").innerHTML=t?"退出批量管理":"批量管理",$("btnBatchBottom").title=$("btnBatchBottom").innerHTML=t?"退出批量管理":"批量管理",$("divBatchOper").style.display=t?"":"none",$("divBatchOperBottom").style.display=t?"":"none",t?(QZFL.css.addClassName($("ulCommentList"),"list_batch_processing"),QZFL.css.addClassName($("ulCommentList"),"list_batch_processing_noavatar")):(QZFL.css.removeClassName($("ulCommentList"),"list_batch_processing"),QZFL.css.removeClassName($("ulCommentList"),"list_batch_processing_noavatar")),(IS_STAR||IS_BIZ||IS_CERTIFIED)&&(t?QZFL.css.removeClassName($("ulCommentList"),"list_without_avatar"):QZFL.css.addClassName($("ulCommentList"),"list_without_avatar")),$e(".op_basic").each(function(){t?QZFL.css.addClassName(this,"op_normal"):QZFL.css.removeClassName(this,"op_normal")}),_BATCH_MODE=t},updatePageView:function(){var t=_PAGE_DATA.total&&IS_OWNER;t?(this.toggleBathMode(_BATCH_MODE),$("chkSelectAll").checked=!1):this.toggleBathMode(!1),QZFL.css[t?"removeClassName":"addClassName"]($("btnBatch"),"none"),QZFL.css[t?"removeClassName":"addClassName"]($("btnBatchBottom"),"none"),$("cnt").innerHTML=_PAGE_DATA.total},setInitData:function(t){_PAGE_DATA=t},processInitPage:function(){this.setInitData(INIT_DATA),procCommentArea(),this.showUserExtractInfo(INIT_DATA.items),this.bindMenuEvent();for(var t=0;t<INIT_DATA.items.length;t++)_showCommentItemReply(INIT_DATA.items[t]);this.showPagination(CUR_PAGE_INDEX,INIT_DATA.total),this.updatePageView(),setTimeout(function(){MSG.Signature.toggleSignature()},0)},init:function(){this.processInitPage(),this.bindFuncLinkEvent()}},EditCommentEditor=(Kd={},Md="既然来了，就顺便留句话儿吧……",{load:function(t,e){var n=this;e=e||QZFL.emptyFn;var o=Kd[t];!o||(!1)[t]?(QZONE.FP.showMsgbox("正在初始化编辑器，请稍候...",MSG.CONST.MSG_TYPE_LOADING),QZFL.imports("/qzone/veditor/release/ve.qzonemsgboard.js",function(){(!1)[t]?o.onInitComplete.add(function(t){QZONE.FP.hideMsgbox(),e(t)}):((o=VEditor.create({container:$("singleCommentEditorAnchor_"+t),width:"auto",adapter:"qzfl",height:97,domain:"qq.com",plugins:"font,glowfont,color,textjustify,history,linetag,toolbarswitcher,xpaste,sosoemotion,qzonemention",buttons:"fontname,fontsize|bold,italic,underline|color,glowfont|justifyleft,justifycenter,justifyright,justifyfull,emotion|undo,redo"})).onClick.add(function(){QZFL.string.trim(this.getTextContent())==Md&&n.setContent("")}),o.addShortcut("ctrl+enter",function(){MSG_LIST._doModifyComment(_CUR_EDIT_COMMENT_IDX)}),o.onInitComplete.add(function(t){QZONE.FP.hideMsgbox(),e(),o.getBody().style.overflowX="hidden"}),Kd[t]=o)})):e(o)},showEditor:function(t,e){$("singleCommentEditorDiv_"+t).style.display="",this.load(t,e)},hideEditor:function(t,e){$("singleCommentEditorDiv_"+t).style.display="none"},resetInstanceCollection:function(){_CUR_EDIT_COMMENT_IDX=null,Kd={}},getBody:function(t){return Kd[t].getBody()},setDefaultText:function(t){Kd[t].setContent({content:'<span style="font-size:12px; color:gray;">既然来了，就顺便留句话儿吧……</span>',addHistory:!1})},setContent:function(t,e){Kd[t].setContent({content:e})},insertContent:function(t,e){QZFL.string.trim(Kd[t].getTextContent())==Md&&Kd[t].clearContent(),Kd[t].insertHtml({content:e})},getContent:function(t){if(Kd[t])return QZFL.string.trim(Kd[t].getTextContent())==Md?"":Kd[t].getContent()},getUbbContent:function(t){return html2Ubb(this.getContent(t))},clearContent:function(t){return Kd[t].clearContent()},focus:function(t){return Kd[t].focus()}}),Kd,Md,procCommentArea=function(){var t=[],e=$("authorInfo").getElementsByTagName("IMG");e.length&&(t=t.concat(QZFL.dom.collection2Array(e))),t=t.concat($e("#ulCommentList div.cont img").elements||[]),QZFL.each(t,function(e){picsize(e,500,1e3,function(t){e.title=e.alt=t?"点击预览原图":"",t&&(e.onclick=function(){window.open(this.src)})}),e.getAttribute("transImg")&&QZFL.userAgent.ie<7&&e.style.filter&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, src="+e.src+", sizingmethod=scale);",e.src="/ac/b.gif")})},procQuote=function(t){t=(t=t.replace(/\n\x20(^\x20)*/gi,"\n&nbsp;$1").replace(/\x20\x20/g,"&nbsp;&nbsp;").replace(/\n/g,"<br />")).replace(/\[quote\=引自：(.+?)(?:\x20|&nbsp;){1,2}于\x20(.+?)\x20发表的评论\]/g,"引自：<cite>$1</cite>&nbsp;&nbsp;于 <ins>$2</ins> 发表的评论<br />").replace(/\[\/quote\]/g,"");for(var e=0;e<2;e++)t=t.replace(/\x03([^\x03\x01\x02]*?)\x02([^\x03\x01\x02]*?)\x01/g,function(t,e,n){return(QZONE.userAgent.ie?"":"<br />")+'<blockquote style="overflow-x:hidden;font-size:12px;width:400px;border:dashed 1px gray;margin:10px;padding:10px">'+e+"引用内容：<br /><br /><q>"+n+"</q></blockquote>"+(QZONE.userAgent.ie?"":"<br />")});return t=t.replace(/[\x03\x02\x01]/g,""),parseMentionFormat(t)},getUserGrade=function(t){var e=[0,5,10,15,20,30,40,50,60,75,90];if(!(t<90))return Math.floor(Math.sqrt(t/10))+7;for(var n=e.length-2;0<=n;--n)if(0<=t-e[n])return n},isVipUser=function(t){return getOneBitmap(t,27)},isUserVIPExpress=function(t){return getOneBitmap(t,17)},isYearVipExpire=function(t){return hadOpenYearVip(t)&&!isUserVIPExpress(t)},hadOpenYearVip=function(t){return getOneBitmap(t,39)},getUserVIPLevel=function(t){return getBitmap(t,18,4)},getOneBitmap=function(t,e){return parseInt(t.charAt(15-Math.floor((e-1)/4)),16)>>(e-1)%4&1},getBitmap=function(t,e,n){var o,i,s=typeof e,a={};if("object"==s){for(o in e)a[o]=getOneBitmap(t,e[o]);return a}if("number"!=s)return null;for(a="",i=(o=e)+(n=n||1);o<i;o++)a=getOneBitmap(t,o)+a;return parseInt(a,2)};window.isAjaxMode||MSG_LIST.init(),MSG.list=MSG_LIST}(MSG),function(n){var o,i,e="",t={setContent:function(t){e=t},getContent:function(){return e},present:function(){var t=this.getContent();$("divAuthorMsgOper").style.display=IS_OWNER&&t?"":"none"},showEditor:function(){$("divAuthorMsgOper").style.display="none",$("authorInfo").style.display="none",$("editAuthorMsgDiv").style.display="";var t=this.getContent();s.load(function(){s.setContent(t)})},hideEditor:function(){$("divAuthorMsgOper").style.display=IS_OWNER&&this.getContent()?"":"none",$("authorInfo").style.display="",$("editAuthorMsgDiv").style.display="none"},updateAuthorMsg:function(){var t=QZFL.string.trim(s.getUbbContent());QZFL.string.getRealLen(t)>n.CONST.MAX_AUTHORMSG_LENGTH?QZONE.FP.showMsgbox("您编辑的内容长度不能超过 "+n.CONST.MAX_AUTHORMSG_LENGTH+" 个字，请进行适当的删减再进行发表",n.CONST.MSG_TYPE_HINT,3e3):(t={hostUin:QZBlog.Logic.SpaceHostInfo.getUin(),content:t,format:"jsonp"},(t=new QZBlog.Util.NetRequest({url:n.util.getUrl("modifyinfo"),data:t,method:"post",charset:"utf-8",uniqueCGI:!0})).onSuccess=function(t){QZONE.FP.showMsgbox(t.message||"修改成功",n.CONST.MSG_TYPE_SUCC,2e3),location.reload(!0)},t.send())},init:function(){var e=this;QZFL.event.addEvent($("btnEditAuthorMsg"),"click",function(){e.showEditor()}),QZFL.event.addEvent($("btnPostAuthorMsg"),"click",function(){e.updateAuthorMsg()}),QZFL.event.addEvent($("btnCancelAuthorMsg"),"click",function(){e.hideEditor()}),QZFL.event.addEvent(document.body,"click",function(t){t=QZFL.event.getTarget(t);t&&"showAuthorInfoEditor"==t.getAttribute("rel")&&(e.showEditor(),QZFL.event.preventDefault())}),this.setContent(INIT_DATA.authorInfo.htmlMsg||INIT_DATA.authorInfo.msg),this.present()}},s=(i=!1,window.g_V||(window.g_V=parent.g_V),{load:function(e){e=e||QZFL.emptyFn,!o||i?(QZONE.FP.showMsgbox("正在初始化编辑器，请稍候...",n.CONST.MSG_TYPE_LOADING),QZFL.imports("/qzone/veditor/release/ve.qzonemsgboard.js",function(){i?o.onInitComplete.add(function(t){QZONE.FP.hideMsgbox(),e(t)}):(i=!0,(o=VEditor.create({container:"authorMsgEditorAnchor",adapter:"qzfl",width:"auto",height:200,domain:parent.g_domain||"qq.com",plugins:"font,glowfont,color,textjustify,history,toolbarswitcher,linetag,xpaste,emotion,qzonemedia,qzoneimage,imagetools",buttons:"fontname,fontsize|bold,italic,underline|color,glowfont|justifyleft,justifycenter,justifyright,justifyfull,emotion,image|undo,redo"})).onClick.add(function(){;""}),o.addShortcut("ctrl+enter",function(){t.updateAuthorMsg()}),o.onInitComplete.add(function(t){QZONE.FP.hideMsgbox(),i=!1,e(t)}))})):e(o)},setContent:function(t){o.setContent({content:t})},getContent:function(){QZFL.string.trim(o.getTextContent());return o.getContent()},getUbbContent:function(){return html2Ubb(this.getContent())}});window.isAjaxMode||t.init(),n.authorInfo=t}(MSG),function(s){var a,r,c={extraParams:{},onBeforeSubmitHooks:[],onSuccessCommentHooks:[],onLoadHooks:[],_editor:null,_editorLoaded:!1,submitComment:function(){var e,t,o=this,i=QZFL.string.rtrim(l.getUbbContent());if(!i||0==i.length)return alert("您还没有填写留言内容"),void l.focus();switch(function(t){if(0==t.length)return alert("请输入留言内容"),-1;if(QZFL.string.getRealLen(t)>s.CONST.MAX_COMMENT_LENGTH)return QZONE.FP.showMsgbox("您编辑的内容长度不能超过 "+s.CONST.MAX_COMMENT_LENGTH/2+" 个字，请进行适当的删减再进行发表",s.CONST.MSG_TYPE_HINT,2e3),-1;var e=new s.util.ContentProperty(t);if(3<e.image||3<e.imagesize)return alert("对不起，您只能插入3张图片或搜索表情"),-1;if(1<e.qqshow)return alert("对不起，您只能插入一张QQ秀泡泡"),-1;e=/\[ffg,([a-zA-z#0-9]{1,10}),([a-zA-z&#=;0-9]{1,10})\]([^\[]{31,})\[\/ft\]/;return e.test(t)&&!confirm("您设置发光的文字已超过30个，发光字效果将可能失效，确认发表此留言吗？")?-1:(e=/\[ffg,([a-zA-z#0-9]{1,10}),[a-zA-z&#=;0-9]{1,10}\]/g,t.match(e)&&1<t.match(e).length&&!confirm("发光字回复中效果只能使用一次，更多的发光字将无法显示，确认发表此留言吗？")||(e=/\[ffg,([a-zA-z#0-9]{1,10}),([a-zA-z&#=;0-9]{1,10})\](.*\[f.*)\[\/ft\]/).test(t)&&!confirm("若发光字中使用了其它特效，发光字效果将可能失效，确认发表此留言吗？")?-1:0)}(i)){case 0:break;case-1:return void l.focus();default:return}QZFL.each(this.onBeforeSubmitHooks,function(t){return!1!==e&&void(e=t(i))}),!1!==e&&(t=s.util.getUrl("addanswer"),(t=new QZBlog.Util.NetRequest({url:t,data:function(){var t,e,n={content:i,hostUin:SPACE_UIN,uin:LOGIN_UIN,format:"jsonp",inCharset:"utf-8",outCharset:"utf-8"};for(t in $("checkSignInput").checked&&(n.hassign="yes"),o.extraParams)null!=(e=o.extraParams[t])&&"object"!=typeof e&&"function"!=typeof e&&(n[t]=o.extraParams[t]);return n},method:"post",charset:"utf-8",uniqueCGI:!0})).onSuccess=function(t){o.extraParams={},QZFL.each(o.onSuccessCommentHooks,function(t){t(i)}),l.setDefaultText();var e=t.data;QZONE.FP.showMsgbox(t.message||"发表成功",s.CONST.MSG_TYPE_SUCC,2e3);e=e.msgtype;if(1==e||isNaN(e)){if(s.global.auditOn&&!IS_OWNER){s.global.auditNum++;try{$("auditNum").innerHTML=s.global.auditNum}catch(t){}}}else setTimeout(function(){s.list.showPage(1)},1e3)},t.send())},init:function(){var t=this;QZFL.event.addEvent($("btnPostMsg"),"click",function(){t.submitComment()}),QZFL.event.addEvent($("btnWantPost"),"click",function(){t.showEditor()}),QZFL.event.addEvent($("cancelEditorHref"),"click",function(){t.hideEditor()}),$("maskEditor").value="",QZFL.event.addEvent($("maskEditor"),"click",function(){t.showEditor()}),QZFL.event.addEvent($("maskEditor"),"blur",function(){;""}),IS_OWNER?this.hideEditor():(QZFL.css.removeClassName($("maskEditor"),"none"),setTimeout(function(){try{$("maskEditor").focus()}catch(t){}},10),QZFL.css.addClassName($("commentEditorAnchor"),"none"),setTimeout(function(){t.showEditor()},1e3))},onLoad:function(t){this._editorLoaded?t(this.editor):this.onLoadHooks.push(t)},showEditor:function(t,e){t=t||QZFL.emptyFn;var n=this;$("divPostPanel").style.display="",l.load(function(e){t(e),n._editor=e,n._editorLoaded=!0,QZFL.each(n.onLoadHooks,function(t){t(e)})},e)},hideEditor:function(){$("divPostPanel").style.display="none",$("cancelEditorHref").style.display="none",l.clearContent()},insertContent:function(t){this.showEditor(function(){l.insertContent(t)})},getContent:function(t){this.showEditor(function(){t(l.getContent())})},getUbbContent:function(t){this.showEditor(function(){t(l.getUbbContent())})},setContent:function(t,e){this.showEditor(function(){l.setContent(t)},e)}},l=(r=!1,{load:function(n,o){s.util.scrollTo($("divPostPanel"));var i=this;if(n=n||QZFL.emptyFn,a&&!r){var t=o&&o.height||91;return a.focus(),a.setHeight(t),void n(a)}QZFL.css.removeClassName($("maskEditor"),"none"),$("maskEditor").focus(),$("maskEditor").title="正在加载编辑器...",QZFL.css.addClassName($("commentEditorAnchor"),"none"),QZFL.imports("/qzone/veditor/release/ve.qzonemsgboard.js",function(){var t,e;r?a.onInitComplete.add(function(t){n(t)}):(t=IS_STAR||IS_BIZ||IS_CERTIFIED?"emotion,history,linetag,xpaste,qzonemention":"font,glowfont,color,textjustify,history,linetag,toolbarswitcher,xpaste,emotion,qzonemention",e=IS_STAR||IS_BIZ||IS_CERTIFIED?"emotion":"fontname,fontsize|bold,italic,underline|color,glowfont|justifyleft,justifycenter,justifyright,justifyfull|emotion|undo,redo|toolbarswitcher",r=!0,(a=VEditor.create({container:"commentEditorAnchor",advToolbarClass:"msg_less_tools",advToolbarText:"高级模式",normalToolbarText:"普通模式",toolbarMode:"advance",adapter:"qzfl",width:"auto",domain:"qq.com",height:o&&o.height||91,plugins:t,buttons:e})).onClick.add(function(){;""}),a.onKeyUp.addLast(function(){;""}),a.addShortcut("ctrl+enter",function(){c.submitComment()}),a.onInitComplete.add(function(t){i.setContent($("maskEditor").value),QZFL.css.addClassName($("maskEditor"),"none"),QZFL.css.removeClassName($("commentEditorAnchor"),"none"),a.focus(),r=!1,n(t)}))})},setDefaultText:function(){a.setContent({content:"",addHistory:!1})},setContent:function(t){a.setContent({content:t})},insertContent:function(t){QZFL.string.trim(a.getTextContent());a.insertHtml({content:t})},getContent:function(){QZFL.string.trim(a.getTextContent());return a.getContent()},getUbbContent:function(){return html2Ubb(this.getContent())},clearContent:function(){return a&&a.clearContent()},focus:function(){return a.focus()}});c.init(),s.comment=c}(MSG),parent.g_isFriend,function(s){var g="http://qzonestyle.gtimg.cn/qzone/em/recommendedImages/",t=[["撒花啦","063.gif","063_thumb.gif",100,100],["福","002.png","002_thumb.png",158,123],["感动","145.gif","145_thumb.gif",100,100],["抱一下","032.gif","032_thumb.gif",100,100],["搞怪","024.png","024_thumb.png",180,180],["为什么呀","147.gif","147_thumb.gif",100,100],["得瑟","148.gif","148_thumb.gif",100,100]],a=[],e={panelNode:$("funEmoCon"),init:function(){var e='<ul class="clearfix">';QZFL.each(t,function(t){e+='<li><a title="'+t[0]+'" href="'+g+t[1]+'" target="_blank"><img alt="'+t[0]+'" _width="'+t[3]+'" _height="'+t[4]+'" _src="'+g+t[1]+'" src="'+g+t[2]+'"></a></li>'}),e+='<li class="tlink"><a href="javascript:;" id="moreFunnyEmo">更多</a></li></ul>',$("defFunEmoList").innerHTML=e,this._bindEvent(this.panelNode)},getData:function(n,o){var e,i,t;this._loading||(e=this,n=n||1,i=function(){var t=Math.ceil(a.length/8),e=a.slice(8*(n-1),8*n);o(e,t)},a.length?i():(this._loading=!0,QZONE.FP.showMsgbox("正在加载数据，请稍候... ",s.CONST.MSG_TYPE_LOADING,1e4),(t=new QZFL.JSONGetter("/qzone/v6/v6_config/msgboardemotion.js",void 0,null,"utf-8")).onSuccess=function(t){QZONE.FP.hideMsgbox(),QZFL.each(t,function(t){a.push([t.title,t.fileName,t.thumbFileName,t.width,t.height])}),i(),e._loading=!1},t.onError=function(){e.__loading=!1,QZONE.FP.showMsgbox("好像当前网络堵着呢，阁下等会再来哦... ",s.CONST.MSG_TYPE_ERROR,2e3)},t.send("_Callback")))},showPage:function(d){var u=this;this.getData(d,function(t,e){for(var n=1<d?d-1:1,o=d<e?d+1:"",i='<b class="uarr"></b><b class="uarr-in"></b> <a href="javascript:;" rel="close" class="icon-close">关闭</a><div class="more-list"><ul class="clearfix">',s=0;s<t.length;s++){var a=t[s][0],r=t[s][1],c=t[s][2],l=t[s][3],m=t[s][4],r=g+r;i+=['<li><a rel="selectEmotion" alt="'+a+'" _src="'+r+'" _width="'+l+'" _height="'+m+'" onclick="return false;" href="javascript:;">','<img rel="selectEmotion" src="'+(g+c)+'" alt="'+a+'" _src="'+r+'" _width="'+l+'" _height="'+m+'"/>'+a+"</a></li>"].join("")}i+="</ul></div>",i+='<div class="pages"><a href="javascript:;" tp="'+n+'">上一页</a><span class="count">'+d+"/"+e+'</span><a href="javascript:void(0);" tp="'+o+'">下一页</a></div>',QZFL.css.removeClassName(u.panelNode,"none"),u.panelNode.innerHTML=i})},hide:function(){QZFL.css.addClassName(this.panelNode,"none")},_bindEvent:function(e){var o=this;QZFL.event.addEvent(e,"click",function(t){var e,n=QZFL.event.getTarget(t);1==n.nodeType&&("selectEmotion"==n.getAttribute("rel")&&o.insertEmotion(n),(e=parseInt(n.getAttribute("tp"),10))&&(QZFL.event.preventDefault(t),o.showPage(e))),"close"==n.getAttribute("rel")&&(QZFL.event.preventDefault(t),o.hide())}),QZFL.event.addEvent(document.body,"mousedown",function(t){t=QZFL.event.getTarget(t);QZFL.dom.contains(e,t)||"moreFunnyEmo"==t.id||o.hide()}),QZFL.event.addEvent($("defFunEmoList"),"click",function(t){var e=QZFL.event.getTarget(t);1==e.nodeType&&"IMG"==e.tagName&&(o.insertEmotion(e),QZFL.event.preventDefault(t))}),s.comment.onLoad(function(t){t.onClick.add(function(){o.hide()})}),$e("#defFunEmoList img").onHover(function(){o.togglePreview(this.getAttribute("_src"),this.alt,!0)},function(){o.togglePreview(null,null,!1)}),QZFL.event.addEvent($("moreFunnyEmo"),"click",function(){o.showPage(1)}),QZFL.event.addEvent($("funEmoTab"),"click",function(){$e("a",this.parentNode).removeClass("current"),QZFL.css.addClassName(this,"current"),QZFL.css.removeClassName($("defFunEmoList"),"none"),QZFL.css.addClassName($("defTiezhiList"),"none")})},togglePreview:function(t,e,n){var o=$("largeFunEmotion");QZFL.css[n?"removeClassName":"addClassName"](o,"none"),n&&($e("img",o).setAttr("src",t),$e(".name",o).setHtml(e))},insertEmotion:function(t){var e=t.getAttribute("alt"),n=t.getAttribute("_src"),o=t.getAttribute("_width"),t=t.getAttribute("_height");s.comment.insertContent('<img src="'+n+'" alt="'+e+'" width="'+o+'" height="'+t+'"/>')}};e.init(),s.FunEmotion=e}(MSG),function(o){var t="1,2,3,4,5".split(",");({init:function(){var e='<ul class="clearfix">';e+='<li class="reset"><a href="javascript:;" rel="selectTiezhi" data="">无</a></li>',QZFL.each(t,function(t){e+='<li><a href="'+getTiezhiSrc(t)+'" rel="selectTiezhi" data="'+t+'"><img src="'+getTiezhiSrc(t,!0)+'" rel="selectTiezhi" data="'+t+'"></a></li>'}),e+='<li class="tlink none"><a href="javascript:;" rel="moreTieZhi">更多</a></li>',e+="</ul>",$("defTiezhiList").innerHTML=e,this._bindEvent()},_bindEvent:function(){var n=this;QZFL.event.addEvent($("tiezhiTab"),"click",function(){$e("a",this.parentNode).removeClass("current"),QZFL.css.addClassName(this,"current"),QZFL.css.addClassName($("defFunEmoList"),"none"),QZFL.css.removeClassName($("defTiezhiList"),"none")}),QZFL.event.addEvent($("defTiezhiList"),"click",function(t){var e=QZFL.event.getTarget(t);"selectTiezhi"==e.getAttribute("rel")&&(QZFL.event.preventDefault(t),n.setTiezhiToCommentEditor(e.getAttribute("data")))}),o.onBeforeSubmitHooks.push(function(){if(o.extraParams.pasterid)return n.checkVip()}),o.onSuccessCommentHooks.push(function(){n.setTiezhiToCommentEditor()})},setTiezhiToCommentEditor:function(t){var e;t?(e=getTiezhiSrc(t),o.showEditor(function(t){QZFL.dom.setStyle(t.iframeElement.parentNode,"background","url("+e+") no-repeat right bottom white")})):o.showEditor(function(t){QZFL.dom.setStyle(t.iframeElement.parentNode,"background","white")}),o.extraParams.pasterid=t?parseInt(t,10):null},checkVip:function(){return!!QZBlog.Util.getLoginIsVIP()||!(QZONE.FP._t.QZFL.dialog.create("提示信息",{src:"/qzone/msgboard/tiezhi_novip_popup.html"},{showMask:!0,width:360,height:130,buttonConfig:[{type:QZFL.dialog.BUTTON_TYPE.Confirm,text:"继续发表"},{type:QZFL.dialog.BUTTON_TYPE.Cancel,text:"取消"}]}).onConfirm=function(){o.extraParams.pasterid=null,o.submitComment()})}}).init()}(MSG.comment),function(t){function e(){QZONE.FP._t.QZFL.dialog.create("提示信息",{src:"/qzone/msgboard/priv_novip_popup.html"},{showMask:!0,width:360,height:150,buttonConfig:[{type:QZFL.dialog.BUTTON_TYPE.Cancel,text:"取消"}]})}t.onBeforeSubmitHooks.push(function(){if($("privCheck").checked){if(!QZONE.FP.isVipUser(!0))return e(),!1;t.extraParams.secret=1}return!0}),$("privCheckLbl").style.display=IS_OWNER?"none":"",QZFL.event.addEvent($("privCheckLbl"),"mousedown",function(t){if(!QZONE.FP.isVipUser(!0))return e(),QZFL.event.preventDefault(t),!1})}(MSG.comment),function(t){var e={init:function(){var e=this;QZFL.event.addEvent($("signCheck"),"click",function(t){e.toggleSignature()}),QZFL.event.addEvent($("signCheckLink"),"click",function(){QZFL.event.preventDefault();var t=$("signCheck").checked;e.toggleSignature(!t),this.innerHTML=t?"显示签名档":"隐藏签名档",$("signCheck").checked=!t})},getSignatureData:function(t,e){t=new QZBlog.Util.NetRequest({url:"http://r.qzone.qq.com/cgi-bin/user/cgi_sign_batchget",data:{uinlist:t.join("-"),notubb:1,fupdate:1}});t.onSuccess=function(t){e(t)},t.send()},toggleSignature:function(t){var e;t=void 0===t?$("signCheck").checked:!!t,$("signCheckLabel").title=t?"勾选后隐藏用户签名档":"勾选后显示用户签名档",$e(".signature")&&($e(".signature")[t?"removeClass":"addClass"]("none"),t&&(e=[],QZFL.each($e(".signature").elements,function(t){t=t.getAttribute("uin");t&&e.push(t)}),e.length&&this.getSignatureData(e,function(t){var e=t.data;if(e)for(var n=$e(".signature").elements,o=0;o<n.length;o++){var i=n[o].getAttribute("uin");if(!i)break;for(var s=0;s<e.length;s++)if(e[s].uin==i){var a=e[s].sign;a&&(n[o].innerHTML=a,QZFL.css.removeClassName(n[o],"none"));break}}})))}};e.init(),t.Signature=e}(MSG),function(){var t={"#btnEditAuthorMsg":(t=IS_OWNER?"Master.":"Guest.")+"Header.editdefault","#btnToSet":t+"Manager.setting","#btnGotoAudit":t+"Manager.sensorship","#btnBatch":t+"Manager.batch","#pager_bottom a[id^='pager_num']":t+"Manager.certainpage","#pager_bottom a[id^='pager_previous']":t+"Manager.prepage","#pager_bottom a[id^='pager_next']":t+"Manager.nextpage","#pager_top a[id^='pager_num']":t+"Manager.certainpage","#pager_top a[id^='pager_previous']":t+"Manager.prepage","#pager_top a[id^='pager_next']":t+"Manager.nextpage","#ulCommentList span.skin_portrait_round":t+"Column.picture","#ulCommentList a.c_tx.q_namecard":t+"Column.picture","#ulCommentList a.qz_qzone_lv":t+"Column.fruit","#ulCommentList a[rel='reply']":t+"Column.reply","#ulCommentList a[rel='sendGift']":t+"Column.gift","#ulCommentList a[rel='quote']":t+"Column.quote","#ulCommentList a[rel='edit']":t+"Column.edit","#ulCommentList a[rel='delete']":t+"Reply.delete","#ulCommentList a[rel='report']":t+"Column.report","#ulCommentList a[rel='moveBlack']":t+"Column.ban","#ulCommentList button[id$='postButton']":t+"Reply.confirm","#ulCommentList a[id$='cancelButton']":t+"Reply.cancel","#commentEditorAnchor .veButton_veToolbarSwitcher":t+"Edit.highend","#checkSignInput":t+"Edit.sign","#btnPostMsg":t+"Edit.post","#btnWantPost":t+"Bottom.iwant","#defFunEmoList a":t+"edit.FunnyEmotion.Box","#funEmoCon ul a":t+"edit.FunnyEmotion.Layer","#btnBatchBottom":t+"Bottom.batch","#impressActionTriggerBtn":"guest.friend.add","#impressList a.del":"master.friend.del","#tiezhiTab":t+"Edit.note_botton","a[rel=prevent_cheat]":"prevent_cheat_button","#defTiezhiList img":t+"Edit.note_paper"};QZBlog.Logic.TCISDClick.batchBind(t,{url:"/msgboard",domain:"msg.qzone.qq.com",container:document.body,nested:!0,prepare:!0})}();