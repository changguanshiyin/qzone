var OOP=OOP||{};(function(t){"use strict";if(apiInited){return}t.tpl=t.tpl||{};var e=function(t,e,i){t=t||{};var a=e.split("."),r,s;r=a.length;for(s=0;s<r;s++){t=t[a[s]];if(typeof t=="function"){t=t()}if(t===undefined||t===null){break}}return t};t.tpl.format=function(t,i){var a=/\{{([\d\w\.]+)\}}/g,r;return t.replace(a,function(t,a){r=e(i,a);return r===undefined?"":r})}})(OOP);var MOOD=MOOD||{};(function(e){"use strict";if(apiInited){return}var i=0;var a=function(){return i++};(function(t){var e={};var i=function t(i,a){var r=!/\W/.test(i)?e[i]=e[i]||t(document.getElementById(i).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+i.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return a?r(a):r};t.tmpl=i})(window)
;var r=!QZONE.FP.getQzoneConfig("isOwner")&&QZONE.FP.getUserBitmap(36)==1;var s=function(t,e){if(typeof t=="string"){return t}if(!t){return""}var i;i=(new Date).getTime()/1e3;try{i=QZONE.FP.getSvrTime().getTime()/1e3}catch(t){}var a=t;var r=i-a;if(r<=0){return"刚刚"}var s=new Date(a*1e3);var o=new Date(i*1e3);if(e){return s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日"+" "+s.getHours()+":"+(s.getMinutes()>9?s.getMinutes():"0"+""+s.getMinutes())}else if(r<60*60*24){if(s.getDate()==o.getDate()){return s.getHours()+":"+(s.getMinutes()>9?s.getMinutes():"0"+""+s.getMinutes())}else{return"昨天"+s.getHours()+":"+(s.getMinutes()>9?s.getMinutes():"0"+""+s.getMinutes())}}else{if(r<60*60*24*2){if(s.getDate()==new Date(i*1e3-60*60*24*1e3-1).getDate()){return"昨天"+s.getHours()+":"+(s.getMinutes()>9?s.getMinutes():"0"+""+s.getMinutes())}else{return"前天"+s.getHours()+":"+(s.getMinutes()>9?s.getMinutes():"0"+""+s.getMinutes())}}else{if(r<60*60*24*3){
if(s.getDate()==new Date(i*1e3-60*60*24*2*1e3-1).getDate()){return"前天"+s.getHours()+":"+(s.getMinutes()>9?s.getMinutes():"0"+""+s.getMinutes())}else{return s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日"}}else{if(new Date(i*1e3).getFullYear()==s.getFullYear()){return s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日"}else{return s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日"}}}}};var o=function(t){if(!t){return}var e=t;var i=new Image;i.src=t.getAttribute("data-src");i.onload=function(t){var i=t.target.width;var a=t.target.height;if(i/a>=1){if(i>300){a=a*520/i;i=520}}else{if(a>420){i=i*420/a;a=420}}e.setAttribute("style","width:"+i+"px;height:"+a+"px;padding-top: 26px;")}};var n={};var c=function(t){this.data=QZFL.object.extend(true,{uin:"",nickname:"",who:1},t)
;this.avatar_tpl=['<div class="ui_avatar">','<a href="{{profile_url}}"  target="_blank" title="{{nickname}}({{uin}})" data-uin="{{uin}}">','<img src="{{avatar_url}}" alt="{{nickname}}({{uin}})">',"</a>","</div>"].join("")};c.prototype.getUin=function(){return escHTML(this.data.uin+"")};c.prototype.getName=function(){return escHTML(this.data.nickname+"")};c.prototype.getProfileURL=function(){var t="";var e={nickname:this.getName()||this.getUin(),uin:this.getUin(),who:this.data.who};switch(this.data.who){case 3:t=format("http://rc.qzone.qq.com/myhome/weibo/profile/{uin}",e);break;case 2:t=format("http://www.pengyou.com/index.php?mod=profile&u={uin}&adtag=from_profile",e);break;default:t=format("http://user.qzone.qq.com/{uin}",e);break}return t};c.prototype.getAvatarURL=function(t,e){if(window.QZONE&&QZONE.FP&&QZONE.FP.getPURL){return QZONE.FP.getPURL(this.data.uin,t||100)}e="http://qlogo{{host}}.store.qq.com/qzone/{{uin}}/{{uin}}/{{size}}"||e;var i=document.domain=="qq.com";if(!i){
e="http://py.qlogo.cn/friend/{{uin}}/audited/60"||e}return OOP.tpl.format(e,{uin:this.data.uin,size:t||100,host:this.data.uin%4||1})};c.prototype.getProfileLink=function(t){var e='<a href="{url}" target="_blank" class="qz_311_author nickname" data-uin="{uin}">'+(t?"":"@")+"{parsedNickname}</a>";var i={parsedNickname:QZONE.FP.removeUBB(this.getName()||this.getUin()),nickname:this.getName()||this.getUin(),uin:this.getUin(),who:this.data.who,url:this.getProfileURL()};return format(e,i)};c.prototype.getUserLink=function(){var t='<a href="{url}" onclick="return false;"  class="qz_311_author c_tx nickname goProfile" profileUin="{uin}" profilePft="{who}" data-uin="{uin}">{parsedNickname}</a>';var e={parsedNickname:QZONE.FP.removeUBB(this.getName()||this.getUin()),nickname:this.getName()||this.getUin(),uin:this.getUin(),who:this.data.who,url:this.getProfileURL()+(this.data.who==1?"/mood":"")};return format(t,e)};c.prototype.getAvatarLink=function(t){var e={
nickname:this.getName()||this.getUin(),uin:this.getUin(),who:this.data.who,avatar_url:this.getAvatarURL(t),profile_url:this.getProfileURL()};return OOP.tpl.format(this.avatar_tpl,e)};c.prototype.toJSON=function(){return QZFL.object.extend(true,{},this.data)};var l=function t(e){this.data=QZFL.object.extend(true,{},e);if(this.data.rt_con&&this.data.rt_con.conlist){this.data.rtitem={};this.data.rtitem.rich_info=this.data.pic;this.data.rtitem.created_time=this.data.rt_created_time;this.data.rtitem.createTime=this.data.rt_createTime;this.data.rtitem.nosrc=this.data.rt_nosrc;this.data.rtitem.rt_account=this.data.rt_account;this.data.rtitem.wbid=this.data.rt_wbid;this.data.rtitem.t1_source=this.data.rt_source;this.data.rtitem.t1_subtype=this.data.rt_subtype;this.data.rtitem.source_name=this.data.rt_source_name;this.data.rtitem.source_url=this.data.rt_source_url;this.data.rtitem.rt_sum=this.data.rt_sum;this.data.rtitem.tid=this.data.rt_tid;this.data.rtitem.uin=this.data.rt_uin
;this.data.rtitem.name=this.data.rt_uinname;this.data.rtitem.conlist=this.data.rt_con.conlist;this.data.rtitem.content=this.data.rt_con.content;this.data.rtitem.cmtnum=this.data.rt_cmtnum;this.data.rtitem.has_more_con=this.data.rt_has_more_con;this.data.rtitem.long_article=this.data.rt_long_article}this.data.commentlist=this.data.commentlist||[];this.cmc=new h(this.data.commentlist||{});this.seed=a();if(this.data&&this.data.pic&&this.data.pic.length>0){for(var i=0;i<this.data.pic.length;i++){if(this.data.pic[i].is_video){this.data.pic[i].pic_id=this.data.pic[i].url1}}this.data.video=null;this.data.videototal=0}n[this.data.tid||"item-"+this.seed]=this};l.prototype.getText=function(t){t=QZFL.object.extend({emoji:true,hashtag:true,link:true},t);var e=this.data.conlist||[];var i,a,r;var s=[];for(i=0;i<e.length;i++){a=e[i];switch(a.type){case 0:s.push("@"+escHTML(a.nick));break;case 1:if(t.link){s.push(escHTML(a.url))}break;case 2:s.push(escHTML(a.con));break}}r=s.join("");if(!t.emoji){
r=r.replace(/\[em\]e(\d{1,8})\[\/em\]/gi,"")}if(!t.hashtag){r=r.replace(/#((?:.|<br\/>)+?)#/gi,"")}r=r.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"");return r};l.prototype.replaceEmoticon=function(t,e){if(e){return QZONE.FP.removeUBB(t)}else{return t.replace(/\[em\]e(\d{1,8})\[\/em\]/gi,"")}};l.prototype.processRichContent=function(t){t=(t||"")+"";var e=/(?:@\{uin:([^\}]*),nick:([^\},]*)(?:,who:(\d+))?\})|[^@]+/g;var i={"%7D":"}","%2C":",","%25":"%"};var a=function(t){if(t){for(var e in i){t=t.replace(e,i[e])}}return t};var r=function(t,e){if("a~b".split(/(~)/).length===3){return t.split(e)}if(!e.global){e=new RegExp(e.source,"g"+(e.ignoreCase?"i":""))}var i,a="",r=[];var s,o=t.length;for(s=0;s<o;s++){a+=t.charAt(s);i=a.match(e);if(i){r.push(a.replace(i[0],""));r.push(i[0]);a=""}}if(a!="")r.push(a);return r};var s=r(t,/(#(?:.|<br\/>)+?#)/g);var o="",n="",c,l,d,u,h,m;for(var p=0;p<s.length;p++){n=s[p];d=false;c="";l="";c=n.replace(/#((?:.|<br\/>)+?)#/g,function(t,e,i){d=true;var a=""
;a='<a href="http://rc.qzone.qq.com/qzonesoso/?search='+encodeURIComponent(e)+'&entry=99&businesstype=mood" target="_blank">#'+escHTML(e)+"#</a>";return a});if(!d){c="";h=n.split(/(@(?!^\{)[\{]uin\:[a-z\d]+\,nick\:[^}]*[\}])/g);for(var _=0;_<h.length;_++){m=h[_];u=false;m=m.replace(e,function(t,e,i,r){i=a(i);if(e){u=true;return format('@<a title="{uin}" target="_blank" href="http://user.qzone.qq.com/{uin}" class="c_tx">{name}</a>',{uin:escHTML(e),name:escHTML(i)})}return escHTML(t)});if(!u){m=m.replace(/((?:https|ftp|http):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,'<a href="$1" target="_blank">$1</a>')}l=l+m}c=l}o=o+c}return o};l.prototype.replaceTopic=function(t){t=restHTML(t);return this.processRichContent(t)};l.prototype.getHTML=function(t){if(this.data.right>1){return"更新了说说"}t=QZFL.object.extend({emoji:true,hashtag:true,link:true,wrapper:true},t);var e='<div class="qz_311_content">{content}</div>'
;var i='<a href="{url}" target="_blank" class="qz_311_mention nickname">@{nickname}</a>';var a='<a href="{url}" target="_blank" class="qz_311_url">{text}</a>';var r='<a href="http://rc.qzone.qq.com/qzonesoso/?search={keyword}&entry=99&businesstype=mood" target="_blank" class="c_tx qz_311_hashtag">{name}</a>';var s=this.data.conlist||[];var o,n,c;var l=[];var d=0;for(o=0;o<s.length;o++){n=s[o];switch(n.type){case 0:switch(n.who){case 3:n.url=format("http://rc.qzone.qq.com/myhome/weibo/profile/{uin}",n);break;case 2:n.url=format("http://www.pengyou.com/index.php?mod=profile&u={uin}&adtag=from_profile",n);break;default:n.url=format("http://user.qzone.qq.com/{uin}",n);break}n.nickname=QZONE.FP.removeUBB(escHTML(n.nick));l.push(format(i,n));break;case 1:d++;if(t.link){n.url=escHTML(n.url);n.text=this.getURLTitle(d)||n.url;l.push(format(a,n))}break;case 2:if(n.con){l.push(this.replaceEmoticon(this.replaceTopic(n.con),t.emoji))}break}}c=l.join("")
;c=c.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"");if(c.length===0){c=this.replaceEmoticon(this.replaceTopic(this.data.content),t.emoji)}if(t.wrapper){c=format(e,{content:c})}return c};l.prototype.getMedia=function(){var t='<div class="qz_311_media">{media}</div>';var e='<img src="{url1}" class="qz_311_photo" data-meta=""/>';var i='<img src="{vimg}" class="qz_311_video" data-meta=""/>';var a="",r,s;var o=this.data.rich_info||[];var n=[];for(r=0;r<o.length;r++){s=o[r];switch(s.type){case 1:n.push(format(e,s));break;case 3:n.push(format(i,s));break}}if(o.length>0){a=format(t,{media:n.join("")})}return a};l.prototype.getFullContent=function(){return this.getHTML()+this.getMedia()};l.prototype.getCreatedTime=function(t){return s(this.data.created_time,t)||this.data.createTime};l.prototype.getTimestamp=function(){return this.data.create_time};l.prototype.getType=function(){var t="original";if(this.data.isSignIn==1){t="sign"}var e=this.data.rich_info||[];var i;for(i=0;i<e.length;i++){
switch(e[i].type){case 1:t="photo";break;case 2:t="video";break}}if(this.data.rtitem||this.data.rt_con){t="retweet"}return t};l.prototype.getSubType=function(){};l.prototype.getCommentCount=function(){return this.data.replies||this.data.reply_num||this.data.cmtnum||0};l.prototype.getRTCount=function(){if(this.data.rtitem){return this.data.rtitem.rt_sum||0}return this.data.rt_sum||0};l.prototype.getForwardNum=function(){if(this.data.rtitem){return this.data.fwdnum||0}return this.data.fwdnum||0};l.prototype.getUserData=function(){var t={who:this.data.nosrc==1?3:1,uin:this.data.nosrc==1?this.data.rt_account:this.data.owneruin||this.data.uin||this.data.owner&&this.data.owner.uin,nickname:this.data.ownername||this.data.name||this.data.owner&&this.data.owner.name};if(document.domain!="qq.com"){t.who=2}if(this.data.wc_uin&&this.data.wc_uin!=""){t.who=2;t.uin=this.data.wc_uin}return t};l.prototype.getAuthor=function(){var t=this.getUserData();var e=new c(t);return e}
;l.prototype.getUserLink=function(){var t=this.getUserData();var e=new c(t);return e.getProfileLink()};l.prototype.getBroadcast=function(t){t=QZFL.object.extend({retweets:true,origin:false},t);var e='<div class="qz_311_content">{content}</div>';var i='<div class="qz_311_rtcontent">{content}</div>';var a,r,s,o;var n=[],c=[];if(this.data.rt_con){c.push(this.getHTML({wrapper:false}));if(this.data.rtlist&&t.retweets){r=this.data.rtlist||[];for(s=r.length-1;s>=0;s--){a=QZFL.object.extend({},r[s]);o=new l(a);c.push(format("{user}: {content}",{user:o.getUserLink(),content:o.getHTML({wrapper:false})}))}}n.push(format(e,{content:c.join(" || ")}));if(t.origin){o=new l(this.data.rtitem);n.push(format(i,{content:o.getFullContent()}))}}return n.join("")};l.prototype.getURLTitle=function(t){return this.data["url_title_"+t]||""};l.prototype.getTid=function(){return this.data.tid};l.prototype.getRTTid=function(){return this.data.rt_tid||""};l.prototype.getUin=function(){
return this.data.owneruin||this.data.uin||""};l.prototype.getRTUin=function(){return this.data.rt_uin||""};l.prototype.getRTMood=function(){if(this.data.rtitem){return new l(this.data.rtitem)}};l.prototype.getPhotosSync=function(){if(this.data.pictotal>0){var t=[],e,i;this.data.pic=this.data.pic||[];for(var a=0;a<this.data.pic.length;a++){e=this.data.pic[a];if(e.hd_pic){i={pre:(e.smallurl||"").replace("qp.qq.com","p.qpimg.cn"),origin:(e.big_pic||"").replace("qp.qq.com","p.qpimg.cn"),big_pic:(e.big_pic||"").replace("qp.qq.com","p.qpimg.cn"),big_width:e.big_width,big_height:e.big_height,hd_pic:(e.hd_pic||"").replace("qp.qq.com","p.qpimg.cn"),hd_width:e.hd_width,hd_height:e.hd_height,tid:this.data.tid,uin:this.data.uin,pic_id:e.pic_id,index:a}}else{i={pre:(e.smallurl||"").replace("qp.qq.com","p.qpimg.cn"),origin:(e.url2||"").replace("qp.qq.com","p.qpimg.cn"),big_pic:(e.url3||"").replace("qp.qq.com","p.qpimg.cn"),big_width:e.b_width||e.width,big_height:e.b_height||e.height,
tid:this.data.tid,uin:this.data.uin,pic_id:e.pic_id,index:a}}t.push(i)}return t}return[]};l.prototype.getPhotos=function(t){var e=this;if(!this._photos){var i={tid:this.data.tid,uin:this.data.owneruin||this.data.uin,plattype:this.data.t1_source,success:function(i){t(i);e._photos=i}};f(i)}else{t(this._photos)}};l.prototype.getVoiceList=function(){if(this.data.voice){var t=[];var e=this.data.voice||[];for(var i=0,a;i<e.length;i++){t.push({id:e[i].id,time:e[i].time,url:e[i].url})}return t}return};l.prototype.getPlatformType=function(){return this.data.t1_source};l.prototype.getRTPlatformType=function(){return this.data.rt_source};l.prototype.getLikeKeys=function(t){var e=typeof t=="number"?true:false;var i=false;if(e){var a=this.data.pic[t];var i=a.url1.indexOf("qzone/em/recommendedImages")!=-1?true:false;var r={key:a.curlikekey||a.unilikekey,uniKey:a.unilikekey,curKey:a.curlikekey};if(!i)return r}var s="";var o="";var n=this.data;var c=n.pictotal==1?true:false;if(c){
var l=n.pic[0].unilikekey;var d=n.pic[0].curlikekey}if(n.rt_tid&&n.rt_nosrc){s=["http://user.qzone.qq.com/119/mood/",n.rt_tid,".",n.rt_source].join("");o=["http://user.qzone.qq.com/",n.uin,"/mood/",n.tid,".",n.t1_source].join("")}else if(n.rt_tid){s=["http://user.qzone.qq.com/",n.rt_uin,"/mood/",n.rt_tid,".",n.rt_source].join("");o=["http://user.qzone.qq.com/",n.uin,"/mood/",n.tid,".",n.t1_source].join("")}else if(c&&!i&&(l||d)){s=l||d;o=d||l}else{s=["http://user.qzone.qq.com/",n.uin,"/mood/",n.tid,".",n.t1_source].join("");o=s}var r={key:["http://user.qzone.qq.com/",this.data.owneruin||this.data.uin,"/mood/",this.data.tid].join(""),uniKey:s,curKey:o};return r};l.prototype.getCommentsHTML=function(){return this.cmc.getHTML()};l.prototype.getComments=function(t){t=QZFL.object.extend({max_comments_count:-1,max_replies_count:-1,order:"asc",callback:function(){}},t);this.cmc.setConfig(t);t.callback(this.cmc)};l.prototype.setConfig=function(t){t=t||{};this.cmc.setConfig(t.comment||{})}
;l.prototype.getPermalink=function(){if(this.data.nosrc==1){return"http://rc.qzone.qq.com/myhome/weibo/agg/"+this.data.wbid}return["http://user.qzone.qq.com/",this.data.owneruin||this.data.uin,"/mood/",this.data.tid,".",this.data.source||this.data.t1_source].join("")};l.prototype.getStoryInfo=function(){if(!this.data.story_info||!this.data.story_info.time||!this.data.story_info.lbs){return""}return['<div class="md">','<div class="c_tx3">',this.data.story_info&&this.data.story_info.time?"拍摄于 "+escHTML(s(this.data.story_info.time)):""," "+(this.data.story_info&&this.data.story_info.lbs&&escHTML(this.data.story_info.lbs.idname||this.data.story_info.lbs.name)),"</div>","</div>"].join("")};l.prototype.getSourceName=function(){return this.data.source_name};l.prototype.getSourceHTML=function(){if(document.domain!="qq.com"&&(this.data.source_name=="QQ空间"||this.data.source_name=="朋友网")){return""}if(!this.data.source_name&&!this.data.t1_source_name){return""}if(this.data.source_url){var t={
source_name:escHTML(this.data.source_name),formated_source_name:QZONE.FP.removeUBB(getRealLen(this.data.source_name)>20?escHTML(cut(this.data.source_name,18,"..")):this.data.source_name),source_url:this.data.source_url};if(this.data.source_name.indexOf("话题圈")>-1){t={source_name:"话题圈",formated_source_name:QZONE.FP.removeUBB(this.data.source_name),source_url:this.data.source_url}}return OOP.tpl.format('<span class="c_tx3">来自<a href="{{source_url}}" target="_blank" title="{{source_name}}"">{{formated_source_name}}</a></span>',t)}return'<span class="c_tx3">来自<span class="custom-tail" title="'+escHTML(this.data.source_name||this.data.t1_source_name)+'">'+escHTML(this.data.source_name||this.data.t1_source_name)+"</span></span>"};l.prototype.getLocationHTML=function(){var t=this.data.lbs;var e=["",'<a href="javascript:void(0);" class="c_tx viewmap icon-location" data-location="{{pos_x}},{{pos_y}}" title="点击查看地图">','<i class="icon-location"></i>',"</a>",""].join("");if(t&&t.pos_x&&t.pos_y){
return OOP.tpl.format(e,{name:escHTML(t.name),pos_x:escHTML(t.pos_x),pos_y:escHTML(t.pos_y)})}return""};l.prototype.toJSON=function(t){var e={content:this.data.content,seed:this.seed,tid:this.data.tid,uin:this.data.uin,tags:this.data.tags,mood_type:this.getTypeHTML(),voice_html:this.getVoiceHTML(),op_button_html:this.getButtonHTML(),content_html:this.getHTML({wrapper:false}),media_preview_html:this.getMediaPreviewHTML(),feed_private_style:this.data.ugc_right==64?"feed_private":"",has_right_style:this.data.right>1?"none":"",nickname:this.getAuthor().getName(),user_link:this.getAuthor().getUserLink(),avatar_url:this.getAuthor().getAvatarURL(),profile_url:this.getAuthor().getProfileURL(),created_time:this.getCreatedTime(),created_time_full:this.getCreatedTime(true),comment_module:this.getCommentModuleHTML(),mod_comments:this.getCommentsHTML(),comment_count:this.getCommentCount()||0,comment_count_html:function(t){if(r){return"评论"}return t?"评论("+t+")":"评论"}(this.getCommentCount()),
retweet_count:this.getRTCount()||0,retweet_count_html:function(t){if(r){return"转发"}return t?"转发("+t+")":"转发"}(this.getRTCount()),source_html:this.getSourceHTML(),source_name:this.getSourceName(),info_html:this.getInfoHTML(),apply_access_html:this.getApplyAccessHTML(),location_html:this.getLocationHTML(),story_info:this.getStoryInfo(),permalink:this.getPermalink(),private_show:this.data.ugc_right==64?"":"none",ellipsis:this.data.has_more_con==1?"......":"",more_words:this.data.has_more_con==1?"展开查看全文":"",more_active:""};if(this.data.long_article){e.more_words="收起";e.more_active="more_active"}if(this.getRTMood()){e["media_preview_html"]=this.getRTHTML();e["voice_html"]=""}return e};l.prototype.getRTButtonHTML=function(){var t=this.getRTMood();if(t){
var e=['<div class="op">','<a href="javascript:void(0);" class="c_tx mouseOver none">举报</a>','<a href="{{permalink}}#action=comment" class="c_tx rt_comment_btn" target="_blank" onclick="return false;">{{comment_count_html}}</a>','<a href="{{permalink}}#action=forward" class="c_tx rt_forward_btn" target="_blank" onclick="return false;">{{retweet_count_html}}</a>',"</div>"].join("");var i=['<div class="op">','<a href="javascript:void(0);" class="c_tx mouseOver none">举报</a>','<a href="{{permalink}}#action=comment" class="c_tx" target="_blank" >{{comment_count_html}}</a>','<a href="{{permalink}}#action=forward" class="c_tx" target="_blank" >{{retweet_count_html}}</a>',"</div>"].join("");var a=t.toJSON();return OOP.tpl.format(t.data.nosrc?i:e,a)}return""};l.prototype.getRTHistoryHTML=function(){var t=this.data.rtlist;if(t){var e=['<div class="chain c_tx3">',"{{retweet_list}}","</div>"].join("");var i=new Object;var a=new Array;var r=""
;var s='<a href="javascript:void(0);" onclick="return false;" target="_blank" class="c_tx goProfile" profileUin="{{uin}}">{{name}}</a>';for(var o=0;o<t.length;o++){var n=t[o];var c=new Object;c[n.uin]=n;QZFL.object.extend(i,c)}for(var l in i){var d=i[l];if(d.uin==QZONE.FP.getQzoneConfig("loginUin")){a.unshift("我")}else{a.push(OOP.tpl.format(s,{uin:d.uin,name:escHTML(d.name)}))}}for(var o=0;o<a.length;o++){if(o==a.length-1){var u=""}else if(a[0]=="我"){var u=o==0?"和":"、"}else{var u=o==a.length-2?"和":"、"}r+=a[o]+u}return OOP.tpl.format(e,{retweet_list:r+"也转发过"})}return""};l.prototype.getRTHTML=function(){var t=this.getRTMood();if(t){
var e=['<div class="md rt_content"><div class="quote bor2">','<div class="bd">','{{user_link}} <pre style="display:inline;">{{content_html}}</pre><span>{{ellipsis}}</span>','<div class="f_toggle">','<a href="javascript:void(0);" onclick="return false;" class="rt_has_more_con {{more_active}}">{{more_words}}</a>',"</div>","{{voice_html}}","</div>","{{media_preview_html}}",'<div class="ft">','<div class="info">','<span class="c_tx3"><a href="{{permalink}}" onclick="return false" isroot="1" class="c_tx c_tx3 goDetail" title="{{created_time_full}}" data-timestamp={{createTime}}>{{created_time}}</a></span>',"{{source_html}}","</div>","{{rt_op_button_html}}","</div>","{{rt_history_html}}","</div></div>"].join("");var i=t.toJSON();i["media_preview_html"]=this.getMediaPreviewHTML();i["voice_html"]=this.getVoiceHTML();i.rt_op_button_html=this.getRTButtonHTML();i.rt_history_html=this.getRTHistoryHTML();return OOP.tpl.format(e,i)}return""};l.prototype.getMediaPreviewHTML=function(){
var t=['<div class="md">',"{{video_thumb_html}}","{{pic_thumb_html}}","{{audio_thumb_html}}","{{magic_thumb_html}}","{{attach_thumb_html}}","{{vote_thumb_html}}",'<div class="md_op {{extend_status}}" data-extend="" >','<a href="#fold" class="md_unfold {{operate_type}}" data-tips="{{extend_tips}}" data-topmedia="{{topmedia}}" >',"{{extend_tips}} 查看详情",'<i class="ico_arr"><b></b></i>',"</a>","</div>","</div>"].join("");var e=["video","pic","audio","magic","attach","vote"];var i={video:{bitmap:3,name:"视频",status:0},pic:{bitmap:1,name:"图片",status:0},audio:{bitmap:7,name:"音乐",status:0},magic:{bitmap:6,name:"动画",status:0},attach:{bitmap:5,name:"附件",status:0},vote:{bitmap:4,name:"投票",status:0}};var a=this.data;var r=[];if(a.attach_type){var s=a.attach_type.toString(2);var o=16;s=new Array(o-s.length+1).join("0")+s;for(var n=0,c;n<e.length;n++){c=e[n];var l=i[c]["bitmap"];if(s.charAt(o-l)==1){r.push(c);i[c]["status"]=1}}}else{for(var n=0,c;n<e.length;n++){c=e[n];if(a[c]){r.push(c)
;i[c]["status"]=1}}}var d="内包含";var u="none";var h="";for(var n=0,c;n<r.length;n++){c=r[n];if(r.length-1==n){d=d+"和"+i[c]["name"]}else if(n==0){d=d+i[c]["name"]}else{d=d+"、"+i[c]["name"]}}if(r.length<2){d=""}else{h=r[0];u=""}var m={extend_status:u,extend_tips:d,topmedia:h,operate_type:a.attach_type?"goDetail":" js_collapse"};for(var n=0,c,p;n<r.length;n++){c=r[n];p={};if(n>0){p={className:"none"}}var _="";switch(c){case"video":_=this.getVideoThumbHTML(p);break;case"pic":_=this.getPhotoThumbHTML(p);break;case"audio":_=this.getMusicThumbHTML(p);break;case"magic":_=this.getMagicHTML(p);break;case"attach":_=this.getAttachHTML(p);break;case"vote":_=this.getVoteHTML(p);break}m[c+"_thumb_html"]=_}return OOP.tpl.format(t,m)};l.prototype.getVoteHTML=function(t){if(!this.data.vote){return""}t=t||{}
;var e=['<div class="vote vote_box bg bor3 smallVote">','<ul class="vote_box_list">',"<%for(var i=0; i<vote.options.length; ++i){%>","<li>",'<input type="<%if(vote.limit == 1){%>radio<%}else{%>checkbox<%}%>" class="input_chkrad"><label class="bg2"><%=vote.options[i]%></label>',"</li>","<%}%>","</ul>","<%if(vote.num > 3){%>",'<p class="vote_box_more bg2"><a href="javascript:void(0);" onclick="return false;" class="c_tx">更多<%=vote.num-3%>项↓</a></p>',"<%}%>","</div>"].join("");return tmpl(e,this.data)};l.prototype.getAttachHTML=function(t){t=t||{};var e=['<div title="点击查看附件" class="feeds_attach bor bg3 smallAttach {{className}}>">','<div class="feeds_attach_icon rbor bg2"></div>','<div class="feeds_attach_content ">','<a href="javascript:void(0);" onclick="return false;" class="c_tx attach_name">{{name}}</a>',"</div>","</div>"].join("");var i=this.data.attach;var a=[];if(i){i.className=t.className;i.name=escHTML(i.name);a.push(OOP.tpl.format(e,i))}return a.join("")}
;l.prototype.getMagicHTML=function(t){t=t||{};var e=['<div class="magic {{className}}">',"<img src=\"/ac/b.gif\" data-id={{id}} onload=\"var _img = this; MOOD.util.require('attachmentThumbnail', function(ATF) { var $atf = new ATF; $atf.resInfo = null; $atf.resInfo={'$type':'magicEmoticon','id': _img.getAttribute('data-id')};$atf.renderAt(_img); _img = null; });\" />","</div>"].join("");var i=this.data.magic||[];var a=[];var r=/{"\$type":"magicEmoticon","id":(\d+)}/;for(var s=0;s<i.length;s++){var o;try{o=i[s].url1.match(r)[1]}catch(t){}if(o){i[s].id=escHTML(o);i[s].className=t.className;a.push(OOP.tpl.format(e,i[s]))}}return a.join("")};l.prototype.getVoiceHTML=function(t){
var e=['<div class="qz_shuoshuo_audio js_play_record ','qz_shuoshuo_audio_{{size}} js-voice-hover bor_bg6" data-id="{{id}}" data-time="{{time}}">','<div class="shuoshuo_audio_inner bg_bor2" style="width:0%">','<div class="audio_icon">','<b class="icon_play bor_bg6"></b>','<b class="icon_pause">','<span class="icon_pause_left bor_bg6"></span>','<span class="icon_pause_right bor_bg6"></span>',"</b>","</div>",'<div class="audio_time">','<span class="c_tx2">{{time}}"</span>',"</div>","</div>","</div>"].join("");var i=function(t){if(t>=40)return"XXL";if(t>25)return"XL";if(t>15)return"L";if(t>5)return"M";return"S"};var a=[];var r=this.data.voice||[];for(var s=0,o;s<r.length;s++){o=r[s];o.size=i(o.time);a.push(OOP.tpl.format(e,o))}return a.join("")};l.prototype.getPhotoThumbHTML=function(){var t={1:"imgscale-big",2:"imgscale-middle",3:"imgscale-small",4:"imgscale-middle",5:"imgscale-small",6:"imgscale-small",7:"imgscale-small",8:"imgscale-small",9:"imgscale-small"};var e={1:"400,300",
2:"200,200",3:"128,128",4:"200,200",5:"128,128",6:"128,128",7:"128,128",8:"128,128",9:"128,128"};var i={"tpl-2-2":2,"tpl-2-3":2,"tpl-3-2":3,"tpl-3-3":3,"tpl-4-2":4,"tpl-4-3":4,"tpl-4-4":4,"tpl-4-5":4,"tpl-5-2":5,"tpl-5-3":5,"tpl-5-4":5,"tpl-6-2":6,"tpl-6-3":6,"tpl-6-4":6,"tpl-6-5":6,"tpl-7-2":7,"tpl-7-3":7,"tpl-8-2":8,"tpl-8-3":8,"tpl-8-4":8,"tpl-9-2":9,"tpl-9-3":9,"tpl-9-4":9,"tpl-9-5":9};var a=9;var r='<div class="img-attachments img_thumb {{className}}"><div class="img-attachments-inner clearfix">{{photo_list}}</div></div>';var s=function(t){var e=escHTML(t.replace(/\/[acmboi]\//gi,"/c/").replace("qp.qq.com","p.qpimg.cn"));if(!/^(https?:)?\/\//.test(e)){e=window.location.protocol+"//"+e}return e};var o=function(i){if(!this.data.pictotal){return""}i=i||{};var o="";var n=Math.min(this.data.pic.length,a);var c=(i.className||"")+" "+t[n]+" smallPic"+" pic";for(var l=0;l<n;l++){var d=this.data.pic[l];d.url1=s(d.url1);d.index=l
;var u='<a href="{{url1}}" title="查看大图" pic-index="{{index}}" '+(d.is_video?'data-video="1" class="video-play-icon"<%}%>':"")+">"+'<img oncontextmenu="this.src=this.src.replace(&#39;&t=5&#39;,&#39;&#39;);this.oncontextmenu=null" src="/qzone/app/mood_v6/images/blank.gif" pic-index="{{index}}" data-src="{{url1}}" data-isphoto="1" class="lazyload" data-limit="'+e[n]+'"/>'+(d.pictype==2?'<span class="gif-flag"></span>':"")+"</a>";o+=OOP.tpl.format(u,d)}o+=this.data.pictotal>a?'<a href="javascript:;" class="see-all"><span>查看全部'+this.data.pictotal+"张照片</span></a>":"";return OOP.tpl.format(r,{photo_list:o,className:c})};var n=function(){var t=0;for(var e=0;this.data.pic&&e<this.data.pic.length;e++){if(this.data.pic[e].richsubtype!=2&&this.data.pic[e].richsubtype!=7){t++}}return t};var c=function(t){var e=this.data.pic_template||""
;var i=['<div class="tpl-item smallPic <%=tplClass%>">',"<ul>","<%for(var i=0;i<pics.length;i++){%>",'<li class="img-item-<%=i+1%>">','<a href="<%if(pics[i].url1.indexOf(\'http://\')!==0){%>http://<%}%><%=escHTML(pics[i].url1)%>" title="查看大图"><img oncontextmenu="this.src=this.src.replace(&#39;&t=5&#39;,&#39;&#39;);this.oncontextmenu=null" src="/ac/b.gif" data-isphoto="1" pic-width="<%=escHTML(pics[i].b_width)%>" pic-height="<%=escHTML(pics[i].b_height)%>" pic-index="<%=i%>" class="typeset-lazyload" data-bigsrc="<%if(pics[i].url3.indexOf(\'http://\')!==0){%>http://<%}%><%=escHTML(pics[i].url3)%>" data-midsrc="<%if(pics[i].url2.indexOf(\'http://\')!==0){%>http://<%}%><%=escHTML(pics[i].url2)%>" data-src="<%if(pics[i].url1.indexOf(\'http://\')!==0){%>http://<%}%><%=escHTML(pics[i].url1)%>" >','<span class="gif-flag <%if(pics[i].pictype!=2){%>none<%}%>"></span>',"</a>","</li>","<%}%>"," </ul>","<%=showAllLinkHTML%>"," </div>"].join("");var a=[]
;for(var r=0;this.data.pic&&r<this.data.pic.length;r++){if(this.data.pic[r].richsubtype!=2&&this.data.pic[r].richsubtype!=7){a.push(this.data.pic[r])}}try{return tmpl(i,{tplClass:e,pics:a,showAllLinkHTML:n.call(this)!=this.data.pictotal?'<a href="javascript:;" class="see-all" pic-index="0"><span pic-index="0">查看全部'+this.data.pictotal+"张照片</span></a>":""})}catch(t){window.console&&console.log("[ERR] 生成排版模版时出错：",t.message)}return""};return function(t){return this.data.pic_template&&i[this.data.pic_template]&&i[this.data.pic_template]==n.call(this)?c.call(this,t):o.call(this,t)}}();l.prototype.getVideoThumbHTML=function(t){t=t||{};var e=[]
;var i=['<div class="video {{className}}" data-video="{{id}}">','<span class="video_wrap smallVideo js-small-video">','<a href="javascript:void(0);" onclick="return false;">','<span class="play_op j-video-play-icon"></span>','<span class="none j-video-loading" style="position: absolute; top: 50%; left: 50%; background-image: url(https://qzonestyle.gtimg.cn/aoi/img/video-loading.gif);width: 40px;height: 24px; margin: -12px 0 0 -20px;"></span>','<img alt="视频缩略图" src="/qzone/app/mood_v6/images/blank.gif" width="400" data-src="{{url1}}" data-limit="400,300" data-isVideo="1" class="lazyload" onload="top.QZONE.getLoadImgSize(this)">',"</a>","</span>","</div>"].join("");if(this.data.videototal>0){var a,r=this.data.video||[];for(a=0;a<r.length;a++){r[a].id=a;r[a].className=t.className;e.push(OOP.tpl.format(i,r[a]))}}else{return""}if(!QZONE.getLoadImgSize){top.QZONE.getLoadImgSize=o}return e.join("")};l.prototype.getMusicThumbHTML=function(t){t=t||{}
;var e=['<div class="music_wrap bor3 bg audio {{className}}">','<div class="music_item">','<a class="img" href="http://music.qq.com/musicbox/html/music.html?songid={{id}}" target="_blank">','<img data-src="{{albumthumb}}" src="/qzone/app/mood_v6/images/blank.gif" class="lazyload">','<span class="tip icon_music_sign"></span>',"</a>",'<div class="info c_tx">','<p class="name">','<a href="javascript:void(0);" target="_blank">{{formatedName}}</a>',"</p>",'<p class="singer">{{singername}}</p>',"</div>",'<div class="op">','<a class="btn_play c_tx bor2 bg js_play_audio" href="javascript:void(0);">','<b class="trig c_tx"></b>',"</a>","</div>","</div>",'<div class="player_holder none">','<a class="c_tx js_hide_audio" href="javascript:void(0);">收起</a>','<div class="flash_holder" id="qzshare_music_box-{{tid}}"></div>',"</div>",'<div class="extra c_tx3 none">','<span class="ui_mr10 qz_orgin_cnt" cnttype="share"></span>',"</div>","</div>"].join("");var i=[];if(this.data.audiototal>0){
var a,r=this.data.audio||[];for(a=0;a<r.length;a++){if(a>0){break}if(r[a].albumid>0){r[a].albumthumb=["//i.gtimg.cn/music/photo/album/",r[a].albumid%100,"/150_albumpic_",r[a].albumid,"_0.jpg"].join("")}else if(r[a].albumimg){r[a].albumthumb=r[a].albumimg}else{r[a].albumthumb="//music.qq.com/musicbox/img/uccpic_error.jpg"}r[a].singername="";r[a].tid=this.data.tid;r[a].className=t.className;r[a].formatedName=escHTML(r[a].name);i.push(OOP.tpl.format(e,r[a]))}}else{return""}return i.join("")};l.prototype.getTypeHTML=function(){return""};l.prototype.getCommentModuleHTML=function(){if(this.data.timershuoshuo===1){return""}
var t=["\x3c!-- 评论区 --\x3e",'<div class="mod_comment" id="comment_list_{{tid}}">',"{{mod_comments}}","\x3c!--发表框 默认--\x3e",'<div class="mod_commnets_poster">\x3c!--如果，发表框在评论列表上面，请加上 class mod_commnets_poster_top 谢谢--\x3e','<div class="comments_poster_bd comments_poster_default">','<div class="comments_box">','<div class="textinput textinput_default bor2" contentEditable="true" placeholder="我也说一句">我也说一句</div>',"</div>","</div>","</div>","</div>"].join("");return OOP.tpl.format(t,{tid:this.getTid(),mod_comments:this.getCommentsHTML()})};l.prototype.getButtonHTML=function(){var i=this.getUin()==QZONE.FP.getQzoneConfig("loginUin");var a=["{{timeshuoshuo_status}}",'<a href="javascript:void(0);" class="c_tx timer_del" >删除</a>'].join("");var s;if(window.t||window.MOOD&&e.env){s=window.t&&t.tab||e.env&&e.env.tab}var o=i&&!this.data.voice&&this.data.t1_source!=2&&this.data.t1_subtype!=33&&this.data.isEditable!==0;if(i&&this.data.video&&this.data.video.length){o=false}
var n=['<div class="dropdown more-edit-items">','\t<a href="javascript:void(0);" class="dropdown-trigger c_tx" id="dLabel_'+this.data.tid+'" data-toggle="dropdown" aria-haspopup="ture" aria-expanded="true">更多<i class="ui_trig ui_trig_b"></i></a>','\t\t<div class="dropdown-menu menu-item-list bor2 bg" role="menu" aria-labelledby="dLabel_'+this.data.tid+'" aria-hidden="false">','\t\t\t<ul role="presentation">',o?'<li><a href="javascript:void(0);" class="edit_btn author_display" role="menuitem">编辑</a></li>':"",s!="detail"?'<li class="add_favorite_container need_bg2"></li>':"",s!="detail"?'<li><a href="javascript:void(0);" class="goDetail" role="menuitem">详情</a></li>':"",i?'<li><a href="javascript:void(0);" class="del del_btn author_display" role="menuitem">删除</a></li>':"","\t\t\t</ul>","\t\t</div>","</div>"].join("")
;var c=['<a href="javascript:void(0);" class="c_tx none">赞</a>','<span id="like_btn_{{tid}}"></span>','<a href="{{permalink}}" class="c_tx comment_btn" target="_blank" onclick="return false;" id="comment_btn_{{uin}}_{{tid}}_{{t1_source}}">{{comment_count_html}}</a>','<a href="{{permalink}}" class="c_tx forward_btn{{voice_class_fix}}" target="_blank" onclick="return false;" id="forward_btn_{{uin}}_{{tid}}_{{t1_source}}">{{forward_num_html}}</a>',s=="detail"?'<span class="add_favorite_container"></span>':"",n].join("")
;var l=['<a href="javascript:void(0);" class="c_tx mouseOver report report_btn" style="display:none;">举报</a>','<a href="javascript:void(0);" class="c_tx none">赞</a>','<span id="like_btn_{{tid}}"></span>','<a href="{{permalink}}" class="c_tx comment_btn" target="_blank" onclick="return false;" id="comment_btn_{{uin}}_{{tid}}_{{t1_source}}">{{comment_count_html}}</a>','<a href="{{permalink}}" class="c_tx forward_btn{{voice_class_fix}}" target="_blank" onclick="return false;" id="forward_btn_{{uin}}_{{tid}}_{{t1_source}}">{{forward_num_html}}</a>',s=="detail"?'<span class="add_favorite_container"></span>':"",s!="detail"?n:""].join("")
;var d=['<a href="{{permalink}}" class="c_tx comment_btn public_show none" target="_blank" onclick="return false;" id="comment_btn_{{uin}}_{{tid}}_{{t1_source}}">{{comment_count_html}}</a>','<a href="{{permalink}}" class="c_tx forward_btn public_show none" target="_blank" onclick="return false;" id="forward_btn_{{uin}}_{{tid}}_{{t1_source}}">{{forward_num_html}}</a>',n].join("");if(this.data.secret===1){return'<div class="op">'+OOP.tpl.format(d,{permalink:this.getPermalink(),comment_count:this.getCommentCount(),retweet_count:this.getRTCount(),uin:this.data.uin,comment_count_html:function(t){if(r){return"评论"}return t?"评论("+t+")":"评论"}(this.getCommentCount()),forward_num_html:function(t){if(r){return"转发"}return t?"转发("+t+")":"转发"}(this.getForwardNum()),tid:this.data.tid,t1_source:this.data.t1_source})+"</div>"}if(this.data.right>1){return""}if(this.data.timershuoshuo===1){var u='<a href="javascript:void(0);" class="c_tx timer_send_now" >立即发送</a>';if(this.data.haspublish){u="已经发送"}
return'<div class="op">'+OOP.tpl.format(a,{timeshuoshuo_status:u})+"</div>"}return'<div class="op">'+OOP.tpl.format(i?c:l,{permalink:this.getPermalink(),comment_count:this.getCommentCount(),retweet_count:this.getRTCount(),uin:this.data.uin,comment_count_html:function(t){if(r){return"评论"}return t?"评论("+t+")":"评论"}(this.getCommentCount()),forward_num_html:function(t){if(r){return"转发"}return t?"转发("+t+")":"转发"}(this.getForwardNum()),voice_class_fix:this.data.voice?" none":"",tid:this.data.tid,t1_source:this.data.t1_source})+"</div>"};l.prototype.getApplyAccessHTML=function(){if(this.data.right==2){return'<div class="secret c_tx3"><span class="encrypt_feeds">该空间已经加密</span>&nbsp;<a href="javascript:void(0);" class="c_tx apply_access">申请访问</a></div>'}if(this.data.right==3){
return'<div class="secret c_tx3"><span class="encrypt_feeds">该空间已经加密</span>&nbsp;<a href="javascript:void(0);" class="c_tx passwrod_required">输入密码并查看</a>&nbsp;<a href="javascript:void(0);" class="c_tx apply_access">申请访问</a></div>'}return""};l.prototype.getInfoHTML=function(){var t=['<div class="info">','<span class="c_tx3">','<a class="c_tx c_tx3 goDetail" title="{{created_time_full}}" href="{{permalink}}">{{created_time}}</a>',"</span>","{{source_html}}","{{location_html}}","{{authorize_html}}","</div>"].join("");var e='<div class="info"><span class="c_tx3">预定于 {{createTime2}} 发送</span></div>';var i=false;try{i=QZONE.FP._t.isOwnerMode()}catch(t){}if(this.data.right>1){return""}if(this.data.timershuoshuo===1){return OOP.tpl.format(e,{createTime2:this.data.createTime2})}return OOP.tpl.format(t,{permalink:this.getPermalink(),created_time:this.getCreatedTime(),created_time_full:this.getCreatedTime(true),source_html:this.getSourceHTML(),location_html:this.getLocationHTML(),
authorize_html:function(t){if(!i){return""}var e;switch(t.ugc_right){case 4:e='<span class="icon-lock" title="QQ好友可见"></span>';break;case 16:e='<span class="icon-lock" title="部分好友可见"></span>';break;case 64:e='<span class="icon-lock" title="仅自己可见"></span>';break;case 128:e='<span class="icon-lock" title="部分好友不可见"></span>';break;default:e="";break}return e}(this.data)})};l.prototype.getItemHTML=function(){
var t=['<li class="feed {{feed_private_style}}" data-tid="{{tid}}" data-uin="{{uin}}" data-seed="item-{{seed}}">','<div class="private_hd private_show {{private_show}}">','<div class="private_bg"></div>',"</div>",'<div class="avatar"><a href="{{profile_url}}" onclick="return false;" class="goProfile" profileUin="{{uin}}" title="{{nickname}}({{uin}})">','<span class="skin_portrait_round"></span>','<img data-src="{{avatar_url}}" src="/qzone/app/mood_v6/images/blank.gif" class="lazyload" alt="{{nickname}}({{uin}})"></a>',"</div>",'<div class="box bgr3">','<div class="arr bor3"><div class="bor_bg3"></div></div>','<div class="bd">','{{user_link}} {{mood_type}} <pre style="display:inline;" class="content">{{content_html}}</pre><span>{{ellipsis}}</span>','<div class="f_toggle">','<a href="javascript:void(0);" onclick="return false;" class="has_more_con {{more_active}}">{{more_words}}</a>',"</div>","{{voice_html}}","</div>","{{media_preview_html}}","{{story_info}}",'<div class="ft">',"{{apply_access_html}}","{{info_html}}","{{op_button_html}}","</div>",'<div class="box_extra bor3 {{has_right_style}}">','<div class="box_extra_arr bor3"><div class="bor_bg3"></div></div>','<div class="feed_like" id="feed_like_{{tid}}" style="display:none;">','<i class="icon_zan"></i>4917人觉得很赞',"</div>","{{comment_module}}","</div>","</div>",'<div class="box_shadow"><div class="shadow_left"></div><div class="shadow_right"></div></div>',"</li>"].join("")
;return OOP.tpl.format(t,this.toJSON())};var u=function(t){this.data=t||{};this.template=['<li class="comments_item bor3">','\t<div class="comments_item_bd">',"\t\t<div>","\t\t\t{{ui_avatar}}",'\t\t\t<div class="comments_content">','\t\t\t\t<a class="nickname" href="http://user.qzone.qq.com/{{uin}}/mood/" target="_self">{{parsedNickname}}</a>',"\t\t\t\t{{privateText}}","\t\t\t\t{{replyTarget}}","\t\t\t\t:","\t\t\t\t<span>{{content_html}}</span>","\t\t\t\t{{commentPhotos}}",'\t\t\t\t<div class="comments_op">','\t\t\t\t\t<span class="c_tx3 ui_mr10">{{create_time}}</span>','\t\t\t\t\t<a href="javascript:void(0);" class="c_tx none" >回复</a>',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>","\t\t{{mod_comments_sub}}","\t</div>","</li>"].join("");this._author=new c({nickname:this.data.name||this.data.owner&&this.data.owner.name||this.data.uin,uin:this.data.uin||this.data.owner&&this.data.owner.uin,who:!!this.data.t3_wc_uin*2||this.data.t3_source||!!this.data.t2_wc_uin*2||this.data.t2_source||1})
;this.replies_tpl='<div class="mod_comments_sub ">{{comments_list}}</div>';this.config={max_replies_count:-1,show_avatar:true};if(this.data.list_3){if(this.data.private){for(var e=0;e<this.data.list_3.length;e++){this.data.list_3[e].private=this.data.private;this.data.list_3[e].isReply=1}}this.replies_list=new h(this.data.list_3);this.replies_list.setTemplate(this.replies_tpl)}};u.prototype.getHTML=function(t){var e={"}":/%7D/g,",":/%2C/g,"%":/%25/g};var i=function(t){if(t){for(var i in e){t=t.replace(e[i],i)}}return t};var a=function(t){if(typeof t=="string"){return t}if(t==0){return""}var e;e=(new Date).getTime()/1e3;try{e=QZONE.FP.getSvrTime().getTime()/1e3}catch(t){}var i=t;var a=e-i;if(a<=0){return"刚刚"}var r=new Date(i*1e3);var s=new Date(e*1e3);if(a<60){return Math.floor(a)+"秒前"}else{if(a<60*60){return Math.floor(a/60)+"分钟前"}else{if(a<60*60*24){if(r.getDate()==s.getDate()){return"今天"+r.getHours()+":"+(r.getMinutes()>9?r.getMinutes():"0"+""+r.getMinutes())}else{
return"昨天"+r.getHours()+":"+(r.getMinutes()>9?r.getMinutes():"0"+""+r.getMinutes())}}else{if(a<60*60*24*2){if(r.getDate()==new Date(e*1e3-60*60*24*1e3-1).getDate()){return"昨天"+r.getHours()+":"+(r.getMinutes()>9?r.getMinutes():"0"+""+r.getMinutes())}else{return"前天"+r.getHours()+":"+(r.getMinutes()>9?r.getMinutes():"0"+""+r.getMinutes())}}else{if(a<60*60*24*3){if(r.getDate()==new Date(e*1e3-60*60*24*2*1e3-1).getDate()){return"前天"+r.getHours()+":"+(r.getMinutes()>9?r.getMinutes():"0"+""+r.getMinutes())}else{return r.getMonth()+1+"月"+r.getDate()+"日"}}else{if(new Date(e*1e3).getFullYear()==r.getFullYear()){return r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()}else{return r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()}}}}}}};if(this.data.list_3){var r=QZFL.object.extend({},this.config);r.max_comments_count=this.config.max_replies_count;this.replies_list.setConfig(r);this.data.mod_comments_sub=this.replies_list.getHTML(false)}this.data.author_link=this._author.getUserLink()
;if(this.config.show_avatar){this.data.ui_avatar=this._author.getAvatarLink(50)}var s=/(?:@\{uin:([\w-_]+),nick:([^\},]*)(?:,who:(\d+))?(?:,auto:(\d+))?\})|[^@]+/g;var o=/(?:@\{uin:([^\}]*),nick:([^\},]*)(?:,who:(\d+))?\})|[^@]+/g;var n=escHTML(this.data.content);var l=this.data.private;this.data.replyTarget=n.replace(s,function(t,e,a,r,s){if(e&&s){var o=new c({nickname:restXHTML(i(a)||e),uin:e,who:r||1});return'<span class="<%if(isPrivate){%>private-txt<%}%>">'+(l?"私密":"")+"回复 "+o.getProfileLink(true)+"</span>"}return""});n=QZFL.FP.removeUBB(n);var d="";if(this.data.private){if(!this.data.isReply){d='<span class="private-txt">私密评论</span>'}else{if(!this.data.replyTarget){d='<span class="private-txt">私密回复</span>'}}}this.data.content_html=n.replace(s,function(t,e,i,a,r){if(e){if(r){return""}var s=new c({nickname:restXHTML(i||e),uin:e,who:a||1});return s.getProfileLink()}return t});var u=this.data.pic;this.data.commentPhotos=function(){if(t){return""}if(!u||!u.length){return""}var e=[]
;for(var i=0;i<u.length;i++){e.push({m_url:u[i].s_url.replace(/\/[acmboi]\//gi,"/m/"),s_url:u[i].s_url,b_url:u[i].b_url})}var a=['<div class="cmt-figure">',"\t<div>","\t\t<%for(var i=0; pics && i<pics.length;i++){%>",'\t\t\t<a href="javascript:void(0)">','\t\t\t\t<img rel="comment_photo" onload="this.onload=null;var imgTag = this;var img=new Image();img.onload=function(){var holderWidth =100;var holderHeight=75;var holderSize=QZFL.dom.getSize(imgTag.parentNode);holderWidth=holderSize[0];holderHeight=holderSize[1]; var width = this.width;\tvar height = this.height;var holderRatio = holderWidth/holderHeight;if(width/height >holderRatio){imgTag.height = holderHeight;}else{imgTag.width = holderWidth;}imgTag.src = img.src;};img.src=imgTag.getAttribute(\'data-murl\');" src="/ac/b.gif" data-murl="<%=escHTML(pics[i].m_url)%>" data-burl="<%=escHTML(pics[i].b_url)%>" data-surl="<%=escHTML(pics[i].s_url)%>">',"\t\t\t</a>","\t\t<%}%>","\t</div>","</div>"].join("");return tmpl(a,{pics:e})}()
;return OOP.tpl.format(this.template,{parsedNickname:QZONE.FP.removeUBB(escHTML(this.data.name)),nickname:escHTML(this.data.name),uin:this.data.uin,ui_avatar:this.data.ui_avatar,content_html:this.data.content_html,create_time:a(this.data.create_time),mod_comments_sub:this.data.mod_comments_sub,replyTarget:this.data.replyTarget,privateText:d,commentPhotos:this.data.commentPhotos})};u.prototype.setConfig=function(t){this.config=QZFL.object.extend(this.config,t)};u.prototype.toJSON=function(){return{}};var h=function(t,e){this._models=[];this.config=QZFL.object.extend({max_comments_count:-1,max_replies_count:-1,order:"asc",show_avatar:true},e);this.template=['<div class="mod_comments">','<div class="comments_list">',"{{comments_list}}","</div>\x3c!-- list end --\x3e","\x3c!-- poster --\x3e","</div>\x3c!-- qz_comments end--\x3e"].join("");if(t){this.init(t)}};h.prototype.init=function(t){t=t||[];var e,i;for(i=0;i<t.length;i++){var a=new u(t[i]);this._models.push(a)}}
;h.prototype.setTemplate=function(t){this.template=t};h.prototype.setConfig=function(t){this.config=QZFL.object.extend(this.config,t);if(this.config.order=="desc"){this._models.reverse()}};h.prototype.getHTML=function(t){var e,i=[];var a=this._models.length>this.config.max_comments_count?this.config.max_comments_count:this._models.length;a=a<0?this._models.length:a;for(e=0;e<a;e++){this._models[e].setConfig(this.config);i.push(this._models[e].getHTML(t))}return OOP.tpl.format(this.template,{comments_list:"<ul>"+i.join("")+"</ul>"})};var m=function t(e){this.opts=e||{};this._models=[];this._pagination={totalRecords:0,rowsPerPage:20,total:0,page:0};this.config={mood:{comment:{},reply:{}}};if(this.opts.initialData){this._pagination.page++;this.init(this.opts.initialData);if(typeof this.opts.success=="function"){this.opts.success(this)}}};m.prototype.init=function(t){this._models=[];t=t||{};this._pagination.totalRecords=typeof t.total=="undefined"?t.usrinfo&&t.usrinfo.msgnum||0:t.total
;this._pagination.total=Math.ceil(this._pagination.totalRecords/this._pagination.rowsPerPage);var e=t.msglist||t.posts||[];var i,a;for(a=0;a<e.length;a++){var r;if(e[a].source_type=="share"){r=new x(e[a])}else{r=new l(e[a])}this._models.push(r)}};m.prototype.setConfig=function(t){this.config=QZFL.object.extend(this.config,t);var e,i;for(e=0;e<this._models.length;e++){i=this._models[e];i.setConfig(this.config.mood)}};m.prototype.apis=function(t){var e,i;var a=[];for(i=0;i<this._models.length;i++){var r=this._models[i];a.push({type:r.getType(),isOriginal:r.getType()=="original",isRetweet:r.getType()=="retweet",isPhoto:r.getType()=="photo",write_time:r.getTimestamp(),original_content:function(t){return function(){return t.getHTML()}}(r),content:function(t){return function(){return t.getFullContent()}}(r),broadcast_content1:function(t){return function(){return t.getBroadcast()}}(r),broadcast_content2:function(t){return function(){return t.getBroadcast({retweets:false})}}(r),
comment_count:r.getCommentCount(),rt_count:r.getRTCount()})}return a};m.prototype.getHTML=function(){var t,e=[],i;for(t=0;t<this._models.length;t++){i=this._models[t];e.push(i.getItemHTML())}return e.join("")};m.prototype.fetch=function(t){t=t||{};var e=this;this._pagination.page++;if(t.page){this._pagination.page=t.page}this.opts.pos=(this._pagination.page-1)*this._pagination.rowsPerPage;var i=this.opts.type;if(typeof H[i]!="undefined"){this.opts.cgi_host=H[i];v(this.opts,function(t){t.msglist=t.msglist||t.posts;e.init(t);if(typeof e.opts.success=="function"){e.opts.success(e)}})}};m.prototype.getPagination=function(){return this._pagination};m.prototype.getSizeSync=function(){if(this._models){return this._models.length}return 0};m.prototype.each=function(t){if(typeof t=="function"){var e;for(e=0;e<this._models.length;e++){var i=this._models[e];(function(t,e){e(t)})(i,t)}}};var p=function(t){var e=this;t=t||{};this.config={uin:t.uin||"",ftype:0,sort:0,pos:t.pos||0,num:t.num||20,
type:t.type||"0",tag:t.type||"1",start_time:t.start_time||"",end_time:t.end_time||"",cur_pos:t.cur_pos||"",total_topics:-1,total:0,success:function(i){if(i.code==0){e.config.start_time=i.start_time;e.config.end_time=i.end_time;e.config.total=i.total;e.config.total_topics=i.total;i.msglist=i.msglist||[];var a=new m(i.msglist);if(typeof t.success=="function"){t.success(a,e)}var r,s=[];for(r=0;r<i.msglist.length&&r<1;r++){s.push(i.msglist[r].tid)}if(s[0]){k({uin:t.uin,id:s[0],src:15})}}else{QZONE.FP.showMsgbox(i.message,5,3e3)}},code_version:1,format:"jsonp"}};p.prototype.go=function(t){var e=this.config.pos;this.config.pos=t>=this.getPagination().total?4294967295:t;this.config.cur_pos=e==4294967295?this.getPagination().total:e;b(this.config)};p.prototype.next=function(){var t=this.config.pos;this.config.pos=this.getPagination().next;this.config.cur_pos=t;b(this.config)};p.prototype.prev=function(){var t=this.config.pos;this.config.pos=this.getPagination().prev
;this.config.cur_pos=t==4294967295?this.getPagination().total:t;b(this.config)};p.prototype.getPagination=function(){var t=Math.ceil(this.config.total/this.config.num);var e=this.config.pos==4294967295?t:parseInt(this.config.pos);return{total:t,next:e+1>t?1:e+1,prev:e-1>0?e-1:4294967295,current:e}};var _=function(t,e,i){try{if(!t){return}var a=window.TCISD;if(!a&&window.QZONE&&window.QZONE.FP&&window.QZONE.FP.getStatPackage){a=QZONE.FP.getStatPackage()}if(a&&a.stringStat){a.stringStat("1000100",{bid:t,rc:e},{reportRate:i||100})}}catch(t){}};var g=function(t){t=t||{};var e={uin:t.uin||"",tid:t.tid||"",t1_source:t.t1_source||"1",ftype:0,sort:0,pos:0,num:20,code_version:1,need_private_comment:1,format:"jsonp"};var i="http://taotao."+document.domain+"/cgi-bin/emotion_cgi_msgdetail_v6";var a=new QZFL.JSONGetter(i,"_get"+Math.random(),e,"utf-8");a.onSuccess=function(i){i=i||{};a=i.result;if(typeof i.code!="undefined"){a={code:i.code,msg:i.message}}if(0==a.code){i.create_time=i.createTime
;i.commentlist=i.commentlist||[];i.reply_num=i.reply_num||i.replies||i.msgTotal||i.commentlist.length;var r=new l(i);if(typeof t.success=="function"){t.success(r)}k({uin:e.uin,id:e.tid,src:9})}else{a.msg==""||QZONE.FP.showMsgbox(a.msg,5,2e3);if(typeof t.error=="function"){t.error(a)}}QZONE.FP._t.TCISD.haboStat({stime:this.endTime-this.startTime,commandid:this._uri,resultcode:d.code,touin:QZONE.FP._t.g_iLoginUin})};a.onError=function(){QZONE.FP._t.TCISD.haboStat({stime:this.endTime-this.startTime,commandid:this._uri,resultcode:999,touin:QZONE.FP._t.g_iLoginUin})};a.onTimeout=function(){QZONE.FP._t.TCISD.haboStat({stime:1e4,commandid:this._uri,resultcode:998,touin:QZONE.FP._t.g_iLoginUin})};a.send("_Callback")};var f=function(t){t=t||{};var e={tid:t.tid||"",uin:t.uin||"",t1_source:1,code_version:1,format:"jsonp"};e.plattype=t.plattype||t.t1_source||1;var i="http://taotao."+document.domain+"/cgi-bin/emotion_cgi_get_pics_v6"
;var a=new QZFL.JSONGetter(i,"_get_photos"+Math.random(),e,"utf-8");a.onSuccess=function(i){i.imageUrls=i.imageUrls||[];var a,r=[],s,o;if(i.images){for(a=0;a<i.images.length;a++){s=i.images[a];if(s.hd_pic){o={origin:s.big_pic,big_pic:s.big_pic,big_width:s.big_width,big_height:s.big_height,hd_pic:s.hd_pic,hd_width:s.hd_width,hd_height:s.hd_height,tid:e.tid,uin:e.uin}}else{o={origin:s.big_pic,big_pic:s.big_pic,big_width:s.big_width,big_height:s.big_height,tid:e.tid,uin:e.uin}}r.push(o)}}else{for(a=0;a<i.imageUrls.length;a++){r.push({origin:i.imageUrls[a],tid:e.tid,uin:e.uin})}}if(typeof t.success=="function"){t.success(r)}};a.send("_Callback")};var v=function(t,e){t=t||{};var i=t.cgi_host.url||"";var a=window._locationCache&&window._locationCache.idcNo;if(t.cgi_host.idc&&a==2){i=i.replace("taotao.qq.com","sh.taotao.qq.com")}var r={uin:t.uin||"",inCharset:"utf-8",outCharset:"utf-8",hostUin:t.hostUin||"",notice:0,sort:0,pos:t.pos||0,num:20,cgi_host:i,code_version:1,format:"jsonp",
need_private_comment:1};var s=new QZFL.JSONGetter(i,"_get_list"+Math.random(),r,"utf-8");if(i.indexOf("emotion_cgi_msglist_v6")>0){window.console&&console.log("调整msglist采样率");s.setReportRate&&s.setReportRate(80)}s.onSuccess=function(t){if(typeof e=="function"){e(t)}QZONE.FP._t.TCISD.haboStat({stime:this.endTime-this.startTime,commandid:this._uri,resultcode:0,touin:QZONE.FP._t.g_iLoginUin})};s.onError=function(){QZONE.FP._t.TCISD.haboStat({stime:this.endTime-this.startTime,commandid:this._uri,resultcode:999,touin:QZONE.FP._t.g_iLoginUin})};s.onTimeout=function(){QZONE.FP._t.TCISD.haboStat({stime:1e4,commandid:this._uri,resultcode:998,touin:QZONE.FP._t.g_iLoginUin})};s.send("_Callback")};var b=function(t){t=t||{};var e={uin:t.uin||"",ftype:0,sort:0,total_topics:t.total_topics||-1,pos:t.pos||1,num:t.num||20,type:t.type||"0",tag:t.tag||"1",start_time:t.start_time||"",end_time:t.end_time||"",cur_pos:t.cur_pos||"",code_version:1,format:"jsonp"}
;var i="http://taotao."+document.domain+"/cgi-bin/emotion_cgi_msglist_by_type_v6";var a=new QZFL.JSONGetter(i,"_get_list"+Math.random(),e,"utf-8");a.onSuccess=function(e){if(typeof t.success=="function"){t.success(e)}};a.send("_Callback")};var y=function(t,e){t.data=t.data||{};t.data.msglist=t.data.msglist||[];var i=new m({initialData:t.data});var a=false;var r=[];i.each(function(t){var e=t.getPhotosSync();for(var i=0;i<e.length;i++){var a=e[i];var s={pre:a.pre,url:a.origin,pic_id:a.pic_id||"",width:a.big_width,height:a.big_height,name:"",index:i};if(a.hd_pic){s.origin_upload=1;s.origin_url=a.hd_pic;s.origin_height=a.hd_height;s.origin_width=a.hd_width}s.tid=t.getTid();s.mood=t;s._infoSrc=t;r.push(s)}});if(typeof e.success=="function"){e.success(r)}if(t.data.msglist.length>0&&t.data.msglist[0]){k({uin:t.data.msglist[0].uin,id:t.data.msglist[0].tid,src:15})}else if(typeof e.error=="function"){e.error({code:t.code,msg:t.message})}};var w=function(t){t=t||{};var e,i,a,r,s;var o=t.bucket
;var n={format:"jsonp",out_charset:"UTF-8"};try{QZONE.FP.getStatPackage().pv("taotao.qq.com","batch_fetch details_"+batches.length)}catch(t){}for(e=0;e<o.length;e++){i=o[e].split(".");n["tid"+e]=i[0];n["uin"+e]=i[1];n["source"+e]=i[2]}n["num"]=o.length;n["uin"]=t.uin;var c="http://taotao."+document.domain+"/cgi-bin/emotion_cgi_getmsgs_detail";if(o.length>15){n.format="fs";var l=new QZFL.FormSender(c,"POST",n,"utf-8");l.onSuccess=function(e){y(e,t)};l.send()}else{n.format="jsonp";var d=new QZFL.JSONGetter(c,null,n,"utf-8");d.onSuccess=function(e){y(e,t)};d.send("_Callback")}};var T=function(t){if(typeof t=="function"){t(p)}else{throw'callback function "fn" required.'}};var k=function(t){var e={uin:"",mod:0,src:9,id:""};QZFL.object.extend(e,t);var i="http://g.qzone."+document.domain+"/cgi-bin/friendshow/cgi_content_visitor";var a=new QZFL.FormSender(i,"POST",e,"utf-8");a.onSuccess=function(t){};a.send()};var x=function t(e){this.data=QZFL.object.extend(true,{},e);if(this.data.rt_con){
this.data.rtitem={};this.data.rtitem.rich_info=this.data.pic;this.data.rtitem.createTime=this.data.rt_createTime;this.data.rtitem.nosrc=this.data.rt_nosrc;this.data.rtitem.rt_account=this.data.rt_account;this.data.rtitem.t1_source=this.data.rt_source;this.data.rtitem.source_name=this.data.rt_source_name;this.data.rtitem.source_url=this.data.rt_source_url||this.data.rt_url;this.data.rtitem.rt_sum=this.data.rt_sum;this.data.rtitem.tid=this.data.rt_tid;this.data.rtitem.uin=this.data.rt_uin;this.data.rtitem.name=this.data.rt_uinname;this.data.rtitem.conlist=this.data.rt_con.conlist;this.data.rtitem.content=this.data.rt_con.content}this.data.commentlist=this.data.commentlist||[];this.cmc=new h(this.data.commentlist||{});this.seed=a();n[""+this.data.tid||"item-"+this.seed]=this};x.prototype.getText=function(t){t=QZFL.object.extend({emoji:true,hashtag:true,link:true},t);var e=this.data.conlist||[];var i,a,r;var s=[];for(i=0;i<e.length;i++){a=e[i];switch(a.type){case 0:
s.push("@"+escHTML(a.nick));break;case 1:if(t.link){s.push(escHTML(a.url))}break;case 2:s.push(escHTML(a.con));break}}r=s.join("");if(!t.emoji){r=r.replace(/\[em\]e(\d{1,8})\[\/em\]/gi,"")}if(!t.hashtag){r=r.replace(/#((?:.|<br\/>)+?)#/gi,"")}r=r.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"");return r};x.prototype.getHTML=function(t){t=QZFL.object.extend({emoji:true,hashtag:true,link:true,wrapper:true},t);var e='<div class="qz_311_content">{content}</div>';var i='<a href="{url}" target="_blank" class="qz_311_mention nickname">@{nickname}</a>';var a='<a href="{url}" target="_blank" class="qz_311_url">{url}</a>';var r='<a href="http://rc.qzone.qq.com/qzonesoso/?search={keyword}&entry=99&businesstype=share" target="_blank" class="c_tx qz_311_hashtag">{name}</a>';var s=this.data.conlist||[];var o,n,c;var l=[];for(o=0;o<s.length;o++){n=s[o];switch(n.type){case 0:switch(n.who){case 3:n.url=format("http://rc.qzone.qq.com/myhome/weibo/profile/{uin}",n);break;case 2:
n.url=format("http://www.pengyou.com/index.php?mod=profile&u={uin}&adtag=from_profile",n);break;default:n.url=format("http://user.qzone.qq.com/{uin}",n);break}n.nickname=escHTML(n.nick);l.push(format(i,n));break;case 1:if(t.link){n.url=escHTML(n.url);l.push(format(a,n))}break;case 2:l.push(escHTML(n.con));break}}c=l.join("");if(!t.emoji){c=c.replace(/\[em\]e(\d{1,8})\[\/em\]/gi,"")}else{c=QZFL.FP.removeUBB(c)}if(!t.hashtag){c=c.replace(/^(?!&)#((?:.|<br\/>)+?)(?!&)#/gi,"")}else{c=c.replace(/^(?!&)#((?:.|<br\/>)+?)(?!&)#/gi,function(t,e){return format(r,{keyword:encodeURIComponent(e),name:escHTML(t)})})}c=c.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"");if(t.wrapper){c=format(e,{content:c})}return c};x.prototype.getMedia=function(){var t='<div class="qz_311_media">{media}</div>';var e='<img src="{url1}" class="qz_311_photo" data-meta=""/>';var i='<img src="{vimg}" class="qz_311_video" data-meta=""/>';var a="",r,s;var o=this.data.rich_info||[];var n=[];for(r=0;r<o.length;r++){s=o[r]
;switch(s.type){case 1:n.push(format(e,s));break;case 3:n.push(format(i,s));break}}if(o.length>0){a=format(t,{media:n.join("")})}return a};x.prototype.getFullContent=function(){return this.getHTML()+this.getMedia()};x.prototype.getCreatedTime=function(){return this.data.create_time||this.data.createTime};x.prototype.getTimestamp=function(){return this.data.create_time};x.prototype.getType=function(){var t="original";if(this.data.isSignIn==1){t="sign"}var e=this.data.rich_info||[];var i;for(i=0;i<e.length;i++){switch(e[i].type){case 1:t="photo";break;case 2:t="video";break}}if(this.data.rtitem||this.data.rt_con){t="retweet"}return t};x.prototype.getSubType=function(){};x.prototype.getCommentCount=function(){return this.data.replies||this.data.reply_num};x.prototype.getForwardNum=function(){return this.data.fwdnum||0};x.prototype.getRTCount=function(){if(this.data.rtitem){return this.data.rtitem.rt_sum||0}return this.data.rt_sum||0};x.prototype.getAuthor=function(){var t={
nickname:this.data.ownername||this.data.name,uin:this.data.owneruin||this.data.uin};var e=new c(t);return e};x.prototype.getUserLink=function(){var t={who:this.data.nosrc==1?3:1,uin:this.data.nosrc==1?this.data.rt_account:this.data.owneruin||this.data.uin,nickname:this.data.ownername||this.data.name};if(this.data.wc_uin&&this.data.wc_uin!=""){t.who=2;t.uin=this.data.wc_uin}var e=new c(t);return e.getProfileLink()};x.prototype.getBroadcast=function(t){t=QZFL.object.extend({retweets:true,origin:false},t);var e='<div class="qz_311_content">{content}</div>';var i='<div class="qz_311_rtcontent">{content}</div>';var a,r,s,o;var n=[],c=[];if(this.data.rt_con){c.push(this.getHTML({wrapper:false}));if(this.data.rtlist&&t.retweets){r=this.data.rtlist||[];for(s=r.length-1;s>=0;s--){a=QZFL.object.extend({},r[s]);o=new x(a);c.push(format("{user}: {content}",{user:o.getUserLink(),content:o.getHTML({wrapper:false})}))}}n.push(format(e,{content:c.join(" || ")}));if(t.origin){o=new x(this.data.rtitem)
;n.push(format(i,{content:o.getFullContent()}))}}return n.join("")};x.prototype.getTid=function(){return this.data.tid};x.prototype.getRTTid=function(){return this.data.rt_tid||""};x.prototype.getUin=function(){return this.data.owneruin||this.data.uin||""};x.prototype.getRTUin=function(){return this.data.rt_uin||""};x.prototype.getRTMood=function(){if(this.data.rtitem){return new x(this.data.rtitem)}};x.prototype.getPhotosSync=function(){if(this.data.pictotal>0){var t=[],e,i;this.data.pic=this.data.pic||[];for(var a=0;a<this.data.pic.length;a++){e=this.data.pic[a];i={origin:decodeURIComponent(e.url1),big_pic:decodeURIComponent(e.url1),big_width:e.width,big_height:e.height,tid:this.data.tid,uin:this.data.uin};t.push(i)}return t}return[]};x.prototype.getPhotos=function(t){var e=this;if(!this._photos){var i={tid:this.data.tid,uin:this.data.owneruin||this.data.uin,plattype:this.data.t1_source,success:function(i){t(i);e._photos=i}};f(i)}else{t(this._photos)}}
;x.prototype.getPlatformType=function(){return this.data.t1_source};x.prototype.getRTPlatformType=function(){return this.data.rt_source};x.prototype.getLikeKeys=function(){var t=new Array(12-this.data.uin.length+1).join("0")+this.data.uin;var e=new Array(12-this.data.uin.length+1).join("0")+this.data.tid;var i=t+e;var a={key:i,uniKey:this.data.rt_source_url,curKey:i};return a};x.prototype.getCommentsHTML=function(){return this.cmc.getHTML()};x.prototype.getComments=function(t){t=QZFL.object.extend({max_comments_count:-1,max_replies_count:-1,order:"asc",callback:function(){}},t);this.cmc.setConfig(t);t.callback(this.cmc)};x.prototype.setConfig=function(t){t=t||{};this.cmc.setConfig(t.comment||{})};x.prototype.getPermalink=function(){return["http://user.qzone.qq.com/",this.data.owneruin||this.data.uin,"/share/",this.data.tid,".",this.data.source||this.data.t1_source].join("")};x.prototype.getSourceHTML=function(){if(this.data.source_url){
return OOP.tpl.format('<a href="{{source_url}}" target="_blank">{{source_name}}</a>',this.data)}return"QQ空间"};x.prototype.getLocationHTML=function(){var t=['<div class="md">','<div class="address c_tx3">','{{name}}  <a href="javascript:void(0);" class="c_tx viewmap" data-location="{{pos_x}},{{pos_y}}">查看地图</a>',"</div>","</div>"].join("");if(this.data.lbs){return OOP.tpl.format(t,this.data.lbs)}return""};x.prototype.getShareType=function(){return this.data.srctype||""};x.prototype.getShareTitle=function(){return escHTML(restHTML(this.data.rt_title))||""};x.prototype.getShareTitleUrl=function(){var t=this.getShareType();var e;switch(t){case 1:e=decodeURIComponent(this.data.rt_url);break;case 17:e=this.data.rt_source_url;break;case 50:e=this.getRTTid()?this.getRTTid().split("|")[0]:"http://rc.qzone.qq.com/mall";break;default:e=e=this.data.rt_url;break}return escHTML(e)};x.prototype.getRTPlatform=function(){var t;switch(this.data.platformid){case 50:t="qzone";break;case 51:t="pengyou"
;break;default:t="other"}return t};x.prototype.getShareSummary=function(){return escHTML(this.data.rt_summary||"")};x.prototype.getRTSourceHTML=function(){if(this.data.srctype==50){return this.data.rt_source_name}if(this.data.rt_source_url){return OOP.tpl.format('<a href="{{rt_source_url}}" class="c_tx3" target="_blank">{{rt_source_name}}</a>',this.data)}if(!this.data.rt_source_name&&this.data.srctype==1){return this.data.rt_uinname}return this.data.rt_source_name};x.prototype.getRTSourceUrl=function(){return this.data.rt_source_url||""};x.prototype.toJSON=function(t){var e={content:this.data.content,seed:this.seed,tid:this.data.tid,uin:this.data.uin,content_html:this.getHTML({wrapper:false}),media_preview_html:this.getMediaPreviewHTML(),nickname:this.getAuthor().getName(),user_link:this.getAuthor().getUserLink(),avatar_url:this.getAuthor().getAvatarURL(),profile_url:this.getAuthor().getProfileURL(),created_time:this.getCreatedTime(),mod_comments:this.getCommentsHTML(),
comment_count:this.getCommentCount()||0,comment_count_html:function(t){if(r){return"评论"}return t?"评论("+t+")":"评论"}(this.getCommentCount()),retweet_count:this.getRTCount()||0,retweet_count_html:function(t){if(r){return"转发"}return t?"转发("+t+")":"转发"}(this.getRTCount()),source_html:this.getSourceHTML(),location_html:this.getLocationHTML(),permalink:this.getPermalink(),forward_num:this.getForwardNum(),forward_num_html:function(t){if(r){return"转发"}return t?"转发("+t+")":"转发"}(this.getForwardNum()),report_style:this.getUin()==QZONE.FP.getQzoneConfig("loginUin")?"none":"",delete_style:this.getUin()==QZONE.FP.getQzoneConfig("loginUin")?"":"",rt_share_title:this.getShareTitle(),rt_share_title_url:this.getShareTitleUrl(),rt_share_summary:this.getShareSummary(),rt_source_html:this.getRTSourceHTML(),rt_source_url:this.getRTSourceUrl()};return e};x.prototype.getMediaPreviewHTML=function(){var t=['<div class="md">',"{{photo_thumb_html}}","{{video_thumb_html}}","{{music_thumb_html}}","</div>"].join("")
;var e={photo_thumb_html:this.getPhotoThumbHTML(),video_thumb_html:this.getVideoThumbHTML(),music_thumb_html:this.getMusicThumbHTML()};return OOP.tpl.format(t,e)};x.prototype.getPhotoThumbHTML=function(){var t=['<div class="img_cube">',"{{photo_list}}","</div>"].join("");var e=[];if(this.data.pictotal>0){var i,a=this.getPhotosSync()||[];for(i=0;i<4&&i<a.length;i++){e.push(OOP.tpl.format('<div class="img_cube_item"><a href="{{share_title_url}}" target="_blank"><img data-src="{{photo.origin}}" src="/qzone/app/mood_v6/images/blank.gif" class="lazyload" data-limit="120,120" alt="photo_thumb_html"></a></div>',{photo:a[i],share_title_url:this.getShareTitleUrl()}))}if(this.data.pictotal>4){e.push(OOP.tpl.format('<a href="{{rt_url}}" class="see-all" target="_blank"><span>查看全部{{pictotal}}张照片</span></a>',{pictotal:this.data.pictotal,rt_url:this.getShareTitleUrl()}))}}else{return""}return OOP.tpl.format(t,{photo_list:e.join("")})};x.prototype.getVideoThumbHTML=function(){var t=[]
;var e=['<div class="video " data-video="{{id}}">','<span class="video_wrap smallVideo">','<a href="javascript:void(0);" onclick="return false;">','<span class="play_op"></span>','<img alt="视频缩略图" data-src="{{url1}}" width="400" src="/qzone/app/mood_v6/images/blank.gif" class="lazyload">',"</a>","</span>","</div>"].join("");if(this.data.videototal>0){var i,a=this.data.video||[];for(i=0;i<a.length;i++){a[i].id=i;t.push(OOP.tpl.format(e,a[i]))}}else{return""}return t.join("")};x.prototype.getMusicThumbHTML=function(){
var t=['<div class="music_wrap bor3 bg">','<div class="music_item">','<a class="img" href="http://music.qq.com/musicbox/html/music.html?songid={{id}}" target="_blank">','<img data-src="{{albumthumb}}" src="/qzone/app/mood_v6/images/blank.gif" class="lazyload">','<span class="tip icon_music_sign"></span>',"</a>",'<div class="info c_tx">','<p class="name">','<a href="javascript:void(0);" target="_blank">{{name}}</a>',"</p>",'<p class="singer">{{singername}}</p>',"</div>",'<div class="op">','<a class="btn_play c_tx bor2 bg js_play_audio" href="javascript:void(0);">','<b class="trig c_tx"></b>',"</a>","</div>","</div>",'<div class="player_holder none">','<a class="c_tx js_hide_audio" href="javascript:void(0);">收起</a>','<div class="flash_holder" id="qzshare_music_box-{{tid}}"></div>',"</div>",'<div class="extra c_tx3 none">','<span class="ui_mr10 qz_orgin_cnt" cnttype="share"></span>',"</div>","</div>"].join("");var e=[];if(this.data.audiototal>0){var i,a=this.data.audio||[]
;for(i=0;i<a.length;i++){if(a[i].albumid>0){a[i].albumthumb=["//",window.siDomain||"qzonestyle.gtimg.cn","/music/photo/album/",a[i].albumid%100,"/150_albumpic_",a[i].albumid,"_0.jpg"].join("")}else if(a[i].albumimg){a[i].albumthumb=a[i].albumimg}else{a[i].albumthumb="//music.qq.com/musicbox/img/uccpic_error.jpg"}a[i].tid=this.data.tid;a[i].singername="";e.push(OOP.tpl.format(t,a[i]))}}else{return""}return e.join("")};x.prototype.getItemHTML=function(){
var t=['<li class="feed" data-type="share" data-tid="{{tid}}" data-uin="{{uin}}" data-sourceurl="{{rt_share_title_url}}" data-seed="item-{{seed}}">','<div class="avatar"><a href="{{profile_url}}" target="_blank" title="{{nickname}}({{uin}})">','<span class="skin_portrait_round"></span>','<img data-src="{{avatar_url}}" src="/qzone/app/mood_v6/images/blank.gif" class="lazyload" alt="{{nickname}}({{uin}})"></a>',"</div>",'<div class="box bgr3">','<div class="arr bor3"><div class="bor_bg3"></div></div>','<div class="bd">','\t{{user_link}} <span class="c_tx3"></span><span>{{content_html}}</span>',"</div>",'<div class="md">','\t<div class="share bor2">',"\t\t\x3c!--shartitle--\x3e",'\t\t<div class="bd">','\t\t\t<h5> <a class="c_tx" href="{{rt_share_title_url}}" target="_blank">{{rt_share_title}}</a>',"\t\t\t</h5>","\t\t\t\x3c!--sharcontent--\x3e",'\t\t\t<p class="content">{{rt_share_summary}}</p>',"\t\t</div>",'\t\t<div class="md">',"\t\t\t\x3c!-- 附件类 结构跟转发的结构一样。 --\x3e","\t\t\t{{media_preview_html}}","\t\t</div>",'\t\t<div class="ft">','\t\t\t<div class="info c_tx3">','<span class="c_tx3">来自{{rt_source_html}}</span>',"\t\t\t</div>",'\t\t\t<div class="op c_tx3">',"{{retweet_count_html}}","\t\t\t</div>","\t\t</div>","\t</div>","</div>","{{location_html}}",'<div class="ft">','<div class="info">','<span class="c_tx3">{{created_time}}</span><span class="c_tx3"> 来自{{source_html}}</span>',"</div>",'<div class="op">','<a href="javascript:void(0);" class="c_tx {{report_style}} mouseOver report visitor_display">举报</a>','<a href="javascript:void(0);" class="c_tx {{delete_style}} del author_display">删除</a>','<a href="javascript:void(0);" class="c_tx none">赞</a>','<span id="like_btn_{{tid}}"></span>','<a href="{{permalink}}" class="c_tx comment_btn" target="_blank" onclick="return false;" id="comment_btn_{{tid}}">{{comment_count_html}}</a>','<a href="{{permalink}}" class="c_tx forward_btn" target="_blank" onclick="return false;">{{forward_num_html}}</a>',"</div>","</div>",'<div class="box_extra bor3">','<div class="box_extra_arr bor3"><div class="bor_bg3"></div></div>','<div class="feed_like" id="feed_like_{{tid}}" style="display:none;">','<i class="icon_zan"></i>4917人觉得很赞',"</div>","\x3c!-- 评论区 --\x3e",'<div class="mod_comment" id="comment_list_{{tid}}">',"{{mod_comments}}","\x3c!--发表框 默认--\x3e",'<div class="mod_commnets_poster">\x3c!--如果，发表框在评论列表上面，请加上 class mod_commnets_poster_top 谢谢--\x3e','<div class="comments_poster_bd comments_poster_default">','<div class="comments_box">','<div class="textinput textinput_default bor2" contentEditable="true" placeholder="我也说一句">我也说一句</div>',"</div>","</div>","</div>","</div>","</div>","</div>",'<div class="box_shadow"><div class="shadow_left"></div><div class="shadow_right"></div></div>',"</li>"].join("")
;return OOP.tpl.format(t,this.toJSON())};var L=0;var M=function(t){if(t.appid==5e3){if(typeof t.success=="function"){t.success({photos:[],total:0})}return}var e=40;t||(t={});var i={uin:t.uin||"",ftype:0,sort:0,pos:L||0,num:e,current_tid:t.mainid,code_version:1,photo_scan_layer:1,format:"jsonp"};var a="http://taotao.qq.com/cgi-bin/emotion_cgi_msglist_v6";var r=new QZFL.JSONGetter(a,"_get_list"+Math.random(),i,"utf-8");var s=new Date;r.setReportRate&&r.setReportRate(80);r.onSuccess=function(i){if(i.code!==0){t.fail&&t.fail(i);return}i.msglist=i.msglist||[];var a=new m({initialData:i});var r=[];var s=0;a.each(function(t){var e=t.getPhotosSync();s+=e.length;for(var i=0;i<e.length;i++){var a=e[i];var o={pre:e[i].pre,url:a.origin,pic_id:a.pic_id||"",name:"",width:a.big_width,height:a.big_height,index:i};if(a.hd_pic){o.origin_upload=1;o.origin_url=a.hd_pic;o.origin_height=a.hd_height;o.origin_width=a.hd_width}o.tid=t.getTid();o.mood=t;o._infoSrc=t;r.push(o)}});L+=e;if(!s){t.fail&&t.fail({
code:-1,message:"找不到对应的照片"});return}if(typeof t.success=="function"){t.success({photos:r,total:s})}};r.onError=function(){if(window.obj2str&&i){i.duration=new Date-s;var t=new Date;var e=new Image;var a;e.onload=function(){this.onload=null;a=new Date-t};setTimeout(function(){if(!a){a=-1}i.timetocdn=a;window.console&&console.log("[info] mood_v6/api.js 拉取cgi出错:",i);try{i.ie=ua.ie;i.chrome=ua.chrome;i.firefox=ua.firefox}catch(t){}_(101003,obj2str(i),100)},3e3);e.src="http://qzonestyle.gtimg.cn/qzone/app/mood_v6/images/blank.gif?r="+Math.random()}};r.send("_Callback")};var q=function(t){if(t.appid==5e3){w(t);return}t=t||{};var e={tid0:t.tid||"",uin0:t.uin||0,source0:t.source||0,num:1,uin:t.loginUin,out_charset:"utf-8",format:"jsonp"};var i="http://taotao.qq.com/cgi-bin/emotion_cgi_getmsgs_detail";var a=new QZFL.JSONGetter(i,"get",e,"utf-8");a.setReportRate&&a.setReportRate(15);var r=new Date;a.onSuccess=function(e){if(e.code!==0){t.fail&&t.fail(e);return}e.data=e.data||{}
;e.data.msglist=e.data.msglist||[];var i=new m({initialData:e.data});var a=false;var r=[];i.each(function(t){var e=t.getPhotosSync();for(var i=0;i<e.length;i++){var a=e[i];var s={pre:a.pre,url:a.origin,pic_id:a.pic_id||"",name:"",width:a.big_width,height:a.big_height,index:i};if(a.hd_pic){s.origin_upload=1;s.origin_url=a.hd_pic;s.origin_height=a.hd_height;s.origin_width=a.hd_width}s.tid=t.getTid();s.mood=t;s._infoSrc=t;r.push(s)}});if(!r.length){t.fail&&t.fail({code:-1,message:"找不到对应的照片"});return}if(typeof t.success=="function"){t.success(r)}if(e.data.msglist.length>0&&e.data.msglist[0]){k({uin:e.data.msglist[0].uin,id:e.data.msglist[0].tid,src:15})}else{t.fail&&t.fail(e)}};a.send("_Callback")};var j=function(t){var e=t.mood;return{name:e.getCreatedTime(),getDescHTML:function(){musicList=e.getVoiceList();if(musicList&&musicList.length){var t=e.getVoiceHTML();return t}var i=null;if(e.getRTMood()){i=e.getRTMood().getHTML()}if(i){
return e.getBroadcast()+" || "+e.getRTMood().getUserLink()+":"+i}else{return e.getHTML()}},uin:e.getAuthor().getUin(),link:"http://user.qzone.qq.com/"+e.getAuthor().getUin()+"/mood",albumname:""}};var O=function(t){var e=t.mood;if(!e){return null}var i={uin:e.getAuthor().getUin(),nickname:restXHTML(e.getAuthor().getName())};return i};var H={index:{url:"https://"+location.hostname+"/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_get_mix_v6",idc:0},mine:{url:"https://"+location.hostname+"/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_msglist_v6",idc:1},weibo:{url:"https://"+location.hostname+"/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_get_tweet_msgs_v6",idc:0},feedlist:{url:"https://"+location.hostname+"/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_feedlist_v6",idc:0},schedule:{url:"https://"+location.hostname+"/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_timershuoshuolist_v6",idc:0}};e.api=e.api||{};e.api.get=g;e.api.getPhotosForTopic=f;e.api.get_multi_details=w
;e.api.visitReport=k;e.api.user=c;e.DataStorage=e.DataStorage||{};e.api.getMoodPhotos=q;e.api.getPhotos=M;e.api.getOwnerInfo=O;e.api.getDetailInfo=j;window.SLIDEVIEW_MOD_311=e.api;var P={UserObject:c,MoodModel:l,MoodModelCollection:m,ShareModel:x};e.load=function(t,i){e.Object=e.Object={};var a=[];if(typeof t=="string"){if(t=="*"){e.Object=P}else{a.push(t)}}else{a=t||[]}for(var r=0;r<a.length;r++){if(typeof P[a[r]]!="undefined"){e.Object[a[r]]=P[a[r]]}}if(typeof i!="undefined"){i(e.Object)}};e.DataStorage.get=function(t){return n[t]};e.DataStorage.set=function(t,e){if(typeof n[t]=="undefined"){return new l(e)}return n[t]}})(MOOD);var apiInited=true;